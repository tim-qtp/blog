<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://tim-qtp.github.io/blog/blog/projectessay/practicalProjects/imageLibrary/12.Miscellaneous.html"><meta property="og:site_name" content="Qtp"><meta property="og:title" content="杂七杂八"><meta property="og:description" content="云图库项目中，你如何存储图片数据？怎么获取到图片信息？ 在云图库项目中，我选择使用对象存储来存储图片文件。一方面，借助云厂商（如腾讯云 COS）提供的对象存储可以快速解决海量图片的存储、传输、扩容和备份问题；另一方面，腾讯云对象存储还提供 “数据万象” 图像处理服务，可以在图片上传时自动解析并返回图片的尺寸、大小、格式等元数据信息。 具体实现流程： 1..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-04-02T09:11:05.000Z"><meta property="article:author" content="tim-qtp"><meta property="article:modified_time" content="2025-04-02T09:11:05.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"杂七杂八","image":[""],"dateModified":"2025-04-02T09:11:05.000Z","author":[{"@type":"Person","name":"tim-qtp","url":"https://github.com/tim-qtp/"}]}</script><link rel="icon" href="/blog/favicon.ico"><link rel="icon" href="/blog/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/blog/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/blog/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/blog/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/blog/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/blog/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>杂七杂八 | Qtp</title><meta name="description" content="云图库项目中，你如何存储图片数据？怎么获取到图片信息？ 在云图库项目中，我选择使用对象存储来存储图片文件。一方面，借助云厂商（如腾讯云 COS）提供的对象存储可以快速解决海量图片的存储、传输、扩容和备份问题；另一方面，腾讯云对象存储还提供 “数据万象” 图像处理服务，可以在图片上传时自动解析并返回图片的尺寸、大小、格式等元数据信息。 具体实现流程： 1...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/blog/assets/style-dcdd17d8.css" as="style"><link rel="stylesheet" href="/blog/assets/style-dcdd17d8.css">
    <link rel="modulepreload" href="/blog/assets/app-72d4e7e3.js"><link rel="modulepreload" href="/blog/assets/framework-48328e23.js"><link rel="modulepreload" href="/blog/assets/12.Miscellaneous.html-79fca68a.js"><link rel="modulepreload" href="/blog/assets/12.Miscellaneous.html-7a28f311.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/blog/" class="brand"><img class="logo" src="/blog/logo.svg" alt="Qtp"><!----><span class="site-name hide-in-pad">Qtp</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link" aria-label="主页"><span class="font-icon icon iconfont icon-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/intro/" class="nav-link" aria-label="笔记"><span class="font-icon icon iconfont icon-discover" style=""></span>笔记<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/life/" class="nav-link" aria-label="生活"><span class="font-icon icon iconfont icon-life" style=""></span>生活<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/about/" class="nav-link" aria-label="关于我"><span class="font-icon icon iconfont icon-about" style=""></span>关于我<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/tim-qtp/blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">搜索</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-computer" style=""></span><span class="title">一、计算机基础</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-vscode" style=""></span><span class="title">二、前端</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="title">三、Java</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-rust" style=""></span><span class="title">四、Rust</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-framework" style=""></span><span class="title">五、框架</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-microservices" style=""></span><span class="title">六、微服务中间件</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-interview" style=""></span><span class="title">七、面试</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-essay" style=""></span><span class="title">八、项目随笔</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-experience" style=""></span><span class="title">技术细节</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-project3" style=""></span><span class="title">实战项目</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-shortlink" style=""></span><span class="title">短链接</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-imageLibrary" style=""></span><span class="title">智能图库</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/1.Image%20upload.html" class="nav-link sidebar-link sidebar-page" aria-label="图片上传"><!---->图片上传<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/2.Audit%20logic.html" class="nav-link sidebar-link sidebar-page" aria-label="审核逻辑"><!---->审核逻辑<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/3.Capture%20Packet%20Batch%20Creation.html" class="nav-link sidebar-link sidebar-page" aria-label="抓包批量创建"><!---->抓包批量创建<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/4.Space%20Module.html" class="nav-link sidebar-link sidebar-page" aria-label="空间模块"><!---->空间模块<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/5.Similar%20Color%20Search.html" class="nav-link sidebar-link sidebar-page" aria-label="相似颜色搜索"><!---->相似颜色搜索<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/6.Photo%20Sharing.html" class="nav-link sidebar-link sidebar-page" aria-label="图片分享"><!---->图片分享<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/7.Batch%20management%20of%20pictures.html" class="nav-link sidebar-link sidebar-page" aria-label="图片批量管理"><!---->图片批量管理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/8.AI%20Image%20Enlargement.html" class="nav-link sidebar-link sidebar-page" aria-label="AI扩图+裁剪编辑"><!---->AI扩图+裁剪编辑<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/9.Gallery%20Analysis.html" class="nav-link sidebar-link sidebar-page" aria-label="图库分析"><!---->图库分析<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/10.Team%20Space.html" class="nav-link sidebar-link sidebar-page" aria-label="团队空间"><!---->团队空间<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/projectessay/practicalProjects/imageLibrary/11.Collaborative%20photo%20editing.html" class="nav-link sidebar-link sidebar-page" aria-label="图片协同编辑"><!---->图片协同编辑<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/blog/projectessay/practicalProjects/imageLibrary/12.Miscellaneous.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="杂七杂八"><!---->杂七杂八<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-logistics" style=""></span><span class="title">神领物流</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-oj" style=""></span><span class="title">刷题OJ平台</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-onlineEducation" style=""></span><span class="title">学成在线</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-flashSale" style=""></span><span class="title">秒杀系统</span><span class="arrow end"></span></button><!----></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-bug" style=""></span><span class="title">bug修复</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-rocket" style=""></span><span class="title">经验教训</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-scaffold" style=""></span><span class="title">脚手架</span><span class="arrow end"></span></button><!----></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-github" style=""></span><span class="title">九、开源推荐</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-xiayu" style=""></span><span class="title">十、技术琐碎</span><span class="arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->杂七杂八</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/tim-qtp/" target="_blank" rel="noopener noreferrer">tim-qtp</a></span><span property="author" content="tim-qtp"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-04-02T09:11:05.000Z"></span><span class="page-pageview-info" aria-label="访问量🔢" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span class="waline-pageview-count" id="ArtalkPV" data-path="/blog/projectessay/practicalProjects/imageLibrary/12.Miscellaneous.html">...</span></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 27 分钟</span><meta property="timeRequired" content="PT27M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category8" role>Java基础</span><span class="page-category-item category3" role>集合</span><meta property="articleSection" content="Java基础,集合"></span><!----></div><hr></div><!----><!----><div class="theme-hope-content"><h4 id="云图库项目中-你如何存储图片数据-怎么获取到图片信息" tabindex="-1"><a class="header-anchor" href="#云图库项目中-你如何存储图片数据-怎么获取到图片信息" aria-hidden="true">#</a> 云图库项目中，你如何存储图片数据？怎么获取到图片信息？</h4><p>在云图库项目中，我选择使用对象存储来存储图片文件。一方面，借助云厂商（如腾讯云 COS）提供的对象存储可以快速解决海量图片的存储、传输、扩容和备份问题；另一方面，腾讯云对象存储还提供 “数据万象” 图像处理服务，可以在图片上传时自动解析并返回图片的尺寸、大小、格式等元数据信息。</p><p>具体实现流程：</p><p>1）项目中整合对象存储：</p><ul><li>在后端配置文件中写好存储桶（bucket）名称、访问域名、密钥等信息，编写一个配置类来读取参数并初始化客户端。</li><li>初始化客户端后，我编写了一个通用的对象存储调用类（CosManager），通过 <code>cosClient.putObject</code> 方法实现上传文件到存储桶。</li><li>基于对象存储调用类进一步封装了适用于本项目的文件上传管理类（FileManager），简化文件上传的调用。</li></ul><p>2）自动获取图片信息：</p><ul><li>在上传图片时，启用 “数据万象” 功能，对图片进行基础信息解析。</li><li>解析结果中包含宽度、高度、格式等字段，我再将这些信息写到数据库表的相应字段，便于后续查询与筛选。</li></ul><p>这样一来，图片实际的二进制数据并不放在后端服务器或数据库中，而是托管给对象存储服务进行管理，既省去了服务器磁盘维护的繁琐，又能利用云存储高可用的特性，提升系统的稳定性和可扩展性。</p><h4 id="云图库项目中-你如何实现图片审核功能" tabindex="-1"><a class="header-anchor" href="#云图库项目中-你如何实现图片审核功能" aria-hidden="true">#</a> 云图库项目中，你如何实现图片审核功能？</h4><p>为了避免用户上传的图片内容违规或存在版权风险，给图片模块增加了 “审核功能”。</p><p>整体策略包括：</p><ol><li>在数据库中为图片表（picture）添加审核状态字段（reviewStatus）和审核信息（reviewMessage、reviewerId、reviewTime）。</li><li>用户上传或编辑图片时，图片默认状态为 “待审核” 或自动过审（如果是管理员上传）；管理员审核后可将状态修改为 “通过” 或 “拒绝”。</li><li>对于审核状态为 “通过” 的图片，普通用户在查询时才能看到；未通过或拒绝的图片仅管理员可见。</li><li>管理员可随时修改图片的审核状态，同时记录审核人、审核时间及原因，方便后期追溯。</li></ol><p>这样一来，既能保证图片内容的安全与合规，也能将违规图片拒之门外，提高系统整体质量。</p><p>此外，其实我还了解更多企业中的审核策略，比如：</p><ol><li>内容安全审核服务：借助专业的第三方平台的内容审核服务来实现自动审核，像腾讯云、阿里云等基本都支持图片、文本、音视频等内容的审核。</li><li>AI 审核：可以将文本内容和审核规则输入给 AI，让 AI 返回是否合规。</li><li>分级审核策略：区分普通用户与高信誉用户，高信誉用户可减少或免除审核流程，比如 VIP 用户自动过审，也可以提高部分效率。</li><li>实名信息和内容溯源：通过用户实名或者手机号注册，提高用户行为的责任感，减少垃圾内容的产生。</li><li>举报机制：通过给平台增加举报机制，还可以给举报行为一些奖励，让用户帮忙维护平台。</li></ol><h4 id="云图库项目中-你如何实现通过-url-上传图片功能" tabindex="-1"><a class="header-anchor" href="#云图库项目中-你如何实现通过-url-上传图片功能" aria-hidden="true">#</a> 云图库项目中，你如何实现通过 URL 上传图片功能？</h4><p>在云图库项目中，我不仅支持用户上传本地图片文件，也支持直接填写网络图片的 URL 链接，后端自动下载并导入到对象存储中。大致流程如下：</p><ol><li>前端将用户输入的图片 URL 发送给后端。</li><li>后端对该链接进行校验：先用 HEAD 请求检查链接是否存在，并获取其文件大小、类型等元信息，而不是下载文件后再校验，可以节约流量。若检测到格式错误（非 JPEG、PNG 等）或文件过大（超过 2MB），则拒绝上传。</li><li>若链接校验通过，后端使用 Hutool 的 <code>HttpUtil.downloadFile</code> 将图片下载到本地临时文件。</li><li>将临时文件上传到对象存储服务，并利用数据万象接口解析图片宽高、大小、格式等元信息。</li><li>将解析到的信息与文件 URL 一起写入数据库，完成导入操作。</li></ol><p>其实步骤 4 和 5 都可以复用我已经实现的本地图片上传功能，因此我也将两种文件上传方式使用模板方法设计模式重构，减少了重复代码，并提高了代码的可扩展性和可维护性。</p><h4 id="什么是模板方法设计模式-在云图库项目中如何使用模板方法模式" tabindex="-1"><a class="header-anchor" href="#什么是模板方法设计模式-在云图库项目中如何使用模板方法模式" aria-hidden="true">#</a> 什么是模板方法设计模式？在云图库项目中如何使用模板方法模式？</h4><p>模板方法设计模式是一种行为型设计模式，它将某一通用流程的各个步骤抽象出来，并定义在父类的 “模板方法” 里，而将具体差异的实现细节留给子类来完成。简单来说，就是 “固定整体流程，允许子类覆盖部分步骤”。</p><p>在云图库项目中，我使用了模板方法模式来统一处理图片上传流程：</p><ol><li>把图片上传的通用步骤（校验 -&gt; 生成临时文件 -&gt; 上传到对象存储 -&gt; 解析图片信息 -&gt; 删除临时文件）定义在抽象类 PictureUploadTemplate 中。</li><li>针对 “本地文件上传” 和 “URL 上传” 两种场景，我分别实现了不同的子类 <code>FilePictureUpload</code> 和 <code>UrlPictureUpload</code>，只需要在 “校验图片”、“获取文件名”、“下载/处理文件” 这几个与输入源相关的步骤上实现不同的逻辑即可，其他步骤则在模板父类里复用。</li></ol><p>这样，不仅减少了大量重复代码，也让后续扩展新的文件来源时更加容易 —— 只需继承抽象类，覆盖相关方法即可，实现了对扩展开放、对修改封闭的设计思路。</p><h4 id="云图库项目中-你怎么实现网络图片的批量抓取和导入功能" tabindex="-1"><a class="header-anchor" href="#云图库项目中-你怎么实现网络图片的批量抓取和导入功能" aria-hidden="true">#</a> 云图库项目中，你怎么实现网络图片的批量抓取和导入功能？</h4><p>核心思路是：利用 Jsoup 实现 Bing 网页图片抓取，并将图片进行批量上传和入库。</p><p>具体步骤：</p><ol><li>指定搜索关键词与抓取数量：管理员在前端界面输入想抓取的关键词（比如 “壁纸”），以及一次要抓取的图片数量。</li><li>爬取图片链接：后端根据关键词拼接目标 URL（Bing 图片搜索的地址），请求返回的 HTML 网页后使用 Jsoup 解析 DOM，获取所有图片的地址。</li><li>逐条下载并上传：对每个图片链接，先做必要的校验（如过滤多余参数），然后将其下载到本地临时文件，最终上传到对象存储服务中。</li><li>插入数据库记录：把每张成功上传的图片信息保存到 picture 表。如果需要分批次命名，可以加个“名称前缀” 参数，让所有图片名称带上统一前缀。</li><li>容错：为防止爬取过快导致被封，通过 Thread.sleep 增加间隔；如果某张图片下载失败或不通过校验，系统会跳过继续下一张图片，最后统计成功条数。</li></ol><p>通过这套批量抓取方案，管理员可一键快速引入大批外部图片，大大减少了前期项目冷启动时手动上传图片的工作量。</p><h4 id="云图库项目中-你通过哪些策略对图片功能进行优化-比如性能和成本优化" tabindex="-1"><a class="header-anchor" href="#云图库项目中-你通过哪些策略对图片功能进行优化-比如性能和成本优化" aria-hidden="true">#</a> 云图库项目中，你通过哪些策略对图片功能进行优化？比如性能和成本优化</h4><p>为提升云图库的性能并降低成本，我对图片查询、上传、加载、存储等环节进行了多方位的优化。</p><p>1）图片查询优化：</p><ul><li>结合 Redis 和 Caffeine，构建了多级缓存体系，先从本地缓存查询，若未命中再查分布式缓存。这样既能充分利用内存的高速访问，又确保了分布式环境下的数据一致性。</li><li>将高频访问的热点图片以及复杂查询结果直接缓存，减少对数据库的压力，成倍缩短了首页响应时间。</li></ul><p>2）图片上传优化：</p><ul><li>在上传时利用数据万象服务自动将图片格式转换为 WebP 进行压缩，有效降低图片文件大小，节省带宽，提升加载速度。</li><li>支持分片上传和断点续传，用于大文件场景，减少网络波动对上传体验的影响。我也尝试过实现文件秒传，通过对文件哈希（MD5）进行校验，避免重复上传。</li></ul><p>3）图片加载优化：</p><ul><li>生成缩略图，在首页或列表页仅加载缩略图，用户查看图片详情时再加载清晰原图，大幅减少流量。</li><li>利用 CDN 加速，将图片资源分配到各地 CDN 节点，用户就近访问，从而降低延迟；并开启浏览器缓存头，进一步提升重复访问的加载速度。</li><li>懒加载技术，让页面只在图片真正出现在可视区域时再请求资源，降低一次性加载的压力。</li></ul><p>4）图片存储优化：</p><ul><li>使用对象存储配合数据沉降（生命周期管理）策略，对 30 天未访问的图片自动切换至低频存储，降低存储费用。</li><li>定期清理不再使用或重复的图片文件，减少冗余占用空间。</li></ul><p>经过上述优化，系统整体的性能显著提升，同时有效地控制了存储与带宽成本。</p><h4 id="什么是-redis-和-caffeine-你在云图库项目中如何利用它们构建多级缓存" tabindex="-1"><a class="header-anchor" href="#什么是-redis-和-caffeine-你在云图库项目中如何利用它们构建多级缓存" aria-hidden="true">#</a> 什么是 Redis 和 Caffeine？你在云图库项目中如何利用它们构建多级缓存？</h4><p>Redis 是一种高性能的分布式 KV 存储，支持丰富的数据结构和高并发访问。它能把缓存数据存储在内存中，单节点读写 QPS 可达 10 万，常用于做分布式缓存或分布式锁。</p><p>Caffeine 是 Java 主流的本地缓存库，运行在 JVM 内部，访问速度比 Redis 更快，但仅能在单个服务实例内使用，无法在多台服务器之间共享数据。</p><p>我在云图库项目中将二者结合，形成多级缓存：</p><ol><li>用户请求先查询 Caffeine 本地缓存</li><li>若本地缓存未命中，则查询 Redis 缓存</li><li>若 Redis 也未命中，则回源到数据库，并将查询结果写回 Redis 与 Caffeine</li></ol><p>这样既保证了本地缓存的高速访问，又利用 Redis 做到跨节点数据一致和高可用，提升性能的同时减少对数据库的重复查询。</p><h4 id="什么是-cdn-云图库项目中如何利用-cdn-提升图片加载性能" tabindex="-1"><a class="header-anchor" href="#什么是-cdn-云图库项目中如何利用-cdn-提升图片加载性能" aria-hidden="true">#</a> 什么是 CDN？云图库项目中如何利用 CDN 提升图片加载性能？</h4><p>CDN 内容分发网络是通过将文件分发到全球或全国各地的加速节点，让用户就近从最近的节点访问资源，减少跨网络、跨地域带来的延迟，提高加载资源的速度。</p><p>在云图库项目里，我将 COS 对象存储作为 “源站”，再给图片地址配置一层 CDN，起到了这些作用：</p><ol><li>请求拦截：用户访问图片时，先由 CDN 节点判断是否有缓存；若已缓存，则直接返回，加快响应；若无缓存，则回源到 COS 存储获取。</li><li>全局分发：CDN 在各地设有大量加速节点，用户与节点间的距离近、线路好，显著缩短 RTT 和传输时延。</li><li>保护源站：高并发时，绝大多数请求被 CDN 节点拦住，源站压力大幅下降。此外我还通过配置防盗链、带宽监控等策略防止资源滥用和 CDN 被刷量。</li></ol><p>使用 CDN 后，我也用 F12 网络控制台看了下请求资源的加载时间，确实加载更快了，也更安全稳定。</p><h4 id="什么是降频存储-在云图库项目中-它起到了什么作用" tabindex="-1"><a class="header-anchor" href="#什么是降频存储-在云图库项目中-它起到了什么作用" aria-hidden="true">#</a> 什么是降频存储？在云图库项目中，它起到了什么作用？</h4><p>降频存储指的是将长时间不访问或访问极少的文件从 “标准存储” 自动迁移到 “低频存储” 或 “归档存储” 的过程，降低资源占用成本。</p><p>COS 对象存储提供了 “生命周期管理” 功能，可以根据设定的规则自动识别并迁移不活跃的数据。</p><p>在云图库项目中，图片在上传初期可能访问量较高，但随着时间推移，不少图片会排到后面的分页中，几乎不会有用户访问。对这类 “冷数据” 图片设置降频存储后，日常占用的存储费用会更低，帮助我们显著节省成本。只有当用户重新访问这些冷数据时才会触发取回费用，但这种情况通常很少，所以我还是开启了降频存储策略。</p><h4 id="什么是文件秒传-在云图库项目中-你怎么实现文件秒传" tabindex="-1"><a class="header-anchor" href="#什么是文件秒传-在云图库项目中-你怎么实现文件秒传" aria-hidden="true">#</a> 什么是文件秒传？在云图库项目中，你怎么实现文件秒传？</h4><p>文件秒传主要运用于大文件上传场景，是通过 “文件指纹” 来识别文件是否已上传过的一种技术。若已存在相同文件，就无需再次传输，直接复用之前的文件存储记录，大幅减少上传时间和流量消耗。</p><p>我的实现思路：</p><ol><li>指纹计算：用户在上传前计算文件 MD5（或 SHA-256）哈希</li><li>指纹查重：后端检索数据库，看是否已有相同指纹的文件</li><li>复用记录：若找到相同文件，则跳过上传过程，直接返回之前的存储地址；若没找到，则正常上传并存储文件指纹。</li></ol><p>在云图库项目中，图片文件不大，因此秒传的收益有限。但如果有用户可能频繁上传同一大文件，通过这种方式可减少重复上传，节省存储与带宽成本。</p><h4 id="什么是文件分片上传和断点续传-在云图库项目中-你怎么实现它们" tabindex="-1"><a class="header-anchor" href="#什么是文件分片上传和断点续传-在云图库项目中-你怎么实现它们" aria-hidden="true">#</a> 什么是文件分片上传和断点续传？在云图库项目中，你怎么实现它们？</h4><p>1）文件分片上传：将一个大文件拆分成多个小块（分片），逐一上传到服务器。这样可以并发上传各分片，提高带宽利用率，同时若部分分片上传失败，仅需重传失败的分片，避免整体重传。</p><p>2）断点续传：在网络中断或上传过程中出现异常时，客户端可从已上传成功的分片或位置继续上传，而不必从头再来，实现更加稳定、高效的大文件上传。</p><p>在云图库项目中，我基于 COS 对象存储服务的 SDK 来实现分片上传与断点续传。只需在调用接口时指定分片参数，后端会自动管理各分片的合并与校验。若中途中断，下次上传请求带上已上传好的分片信息，继续传剩余分片即可，从而显著提升网络不稳定场景下的用户体验和上传效率。</p><h4 id="云图库项目中-你怎么保证用户最多只能创建一个空间" tabindex="-1"><a class="header-anchor" href="#云图库项目中-你怎么保证用户最多只能创建一个空间" aria-hidden="true">#</a> 云图库项目中，你怎么保证用户最多只能创建一个空间？</h4><p>我在云图库项目采用了 <strong>加锁 + 事务</strong> 的方式来限制用户仅能创建一个私有空间：</p><ol><li>数据库设计：在 space 表中根据 userId 查询是否已创建空间，若已创建则阻止再次创建。</li><li>本地分段锁：以 userId 作为锁的 key，进入创建空间的代码前，对该 key 进行 synchronized（或在一个 并发 Map 里）加锁，避免并发下同一个用户多次创建。</li><li>编程式事务：在加锁后，用 transactionTemplate 开启数据库事务，先查询 userId 是否已有空间，再写入新空间记录，若过程中出错则回滚。事务执行完成后释放锁。</li></ol><h4 id="云图库项目中-你怎么保证用户上传图片不会超过空间额度" tabindex="-1"><a class="header-anchor" href="#云图库项目中-你怎么保证用户上传图片不会超过空间额度" aria-hidden="true">#</a> 云图库项目中，你怎么保证用户上传图片不会超过空间额度？</h4><p>为了防止用户无限制占用存储资源，我在云图库项目里为每个空间都配置了最大图片数量（maxCount）和最大总大小（maxSize）两种限制，并且在图片上传和图片删除环节都做了相应的更新与校验：</p><ol><li>上传前校验：根据 spaceId 查到该空间的当前已用大小 totalSize 和数量 totalCount，分别与 maxSize、maxCount 对比。若空间或用户已超出限额，则拒绝这次上传请求。</li><li>上传成功后更新： 进入数据库事务，先写入图片表，再将 totalSize 累加上这张图片的大小、totalCount +1。 若任意一步失败，就回滚事务，保证数据的一致性。</li><li>删除图片后释放： 删除图片时，也在同一事务内把对应的大小和数量从 space 的 totalSize、totalCount 字段中减去，确保计量准确。</li></ol><p>通过 <strong>上传前校验 + 事务内原子更新</strong> 的方式，即使在并发场景下，也能让空间用量处于可控状态，一旦某个空间达到了最大额度就禁止再传图，大幅降低系统被滥用的风险。</p><p>此外，参考大厂云服务的设计，我允许用户小幅超出额度（比如上传最后一张图时，即使会超额也允许上传），一定程度上减少了开发难度，并提升了用户体验。</p><h4 id="云图库项目的后端中-你如何实现多维度的图片搜索功能" tabindex="-1"><a class="header-anchor" href="#云图库项目的后端中-你如何实现多维度的图片搜索功能" aria-hidden="true">#</a> 云图库项目的后端中，你如何实现多维度的图片搜索功能？</h4><p>在云图库项目里，我通过封装图片查询请求类，并在查询接口增加多种筛选条件，来实现多维度的图片搜索。主要思路：</p><ol><li>定义一个 PictureQueryRequest 对象，除了基本的分页参数，还支持按名称、简介、分类、标签、编辑时间范围、格式、宽高等维度传参。</li><li>在服务层写一个 getQueryWrapper 方法，根据请求参数动态构造数据库查询条件，比如 <code>queryWrapper.like(StrUtil.isNotBlank(name), &quot;name&quot;, name)</code> 等。</li><li>在控制层接收搜索请求并调用 service 进行分页查询，结果返回 Page 列表</li></ol><p>前端在搜索表单里，可将这些搜索条件分为常用筛选（关键词、标签、分类）和更多筛选（日期、宽高、格式）等，实现灵活的多维度检索。</p><p>这样就能满足用户 “按关键字 + 标签 + 日期 + …” 多种组合搜索需求，大幅提升查询效率和使用体验。</p><h4 id="云图库项目的后端中-你如何实现以图搜图功能" tabindex="-1"><a class="header-anchor" href="#云图库项目的后端中-你如何实现以图搜图功能" aria-hidden="true">#</a> 云图库项目的后端中，你如何实现以图搜图功能？</h4><p>我在云图库项目中采用了 <strong>实时爬虫</strong> 的方式实现以图搜图。流程如下：</p><ol><li>通过 F12 网络控制台分析百度以图搜图的相关接口</li><li>调用百度以图搜图接口，将图片 URL 传给百度，以获得一个 “搜图页面地址”</li><li>利用 Jsoup 解析返回的 HTML，提取到搜索结果列表的接口地址</li><li>通过 Hutool 的 HttpRequest 调用该接口获取到相似图片、来源链接等信息，封装为一个后端接口返回给前端。</li></ol><p>在实现层面，我为这些步骤（获取页面地址、解析 HTML、拉取图片列表）各自写了一个独立的 API 类，然后用 <strong>门面模式</strong> 将它们统一封装在 ImageSearchApiFacade 类中，对外只暴露一个 searchImage 方法，简化了调用流程，用户只要传入图片 URL 就能得到以图搜图的结果。</p><h4 id="云图库项目的后端中-你如何实现颜色搜图功能" tabindex="-1"><a class="header-anchor" href="#云图库项目的后端中-你如何实现颜色搜图功能" aria-hidden="true">#</a> 云图库项目的后端中，你如何实现颜色搜图功能？</h4><p>整体思路是：先提取和存储每张图片的主色调，再用欧氏距离算法来判断颜色相似度。</p><p>详细流程：</p><ol><li>提取主色调：上传图片后，我利用数据万象服务自动分析图片的主色调，然后将提取到的十六进制色值（如 0xAFB123）保存在数据库的 picColor 字段中。</li><li>用户发起颜色检索：输入一个十六进制色值（如 #FF0000），后端用 Color 类将其转换为 RGB。</li><li>计算相似度：从数据库中查询出每张图的主色调，同样转换为 RGB 后计算二者的欧氏距离 <code>distance = sqrt((R1-R2)^2 + (G1-G2)^2 + (B1-B2)^2)</code>，距离越小表示越相似。</li><li>对结果进行排序，取相似度最高的前 N 张图并返回给前端</li></ol><p>这样，前端用户只要操作一个颜色选择器，就能在空间内找出和指定颜色最接近的图片，大大提高搜图效率。</p><h4 id="云图库项目的后端中-你如何实现批量编辑功能-怎么优化批量编辑的性能" tabindex="-1"><a class="header-anchor" href="#云图库项目的后端中-你如何实现批量编辑功能-怎么优化批量编辑的性能" aria-hidden="true">#</a> 云图库项目的后端中，你如何实现批量编辑功能？怎么优化批量编辑的性能？</h4><p>为了提高空间图片的管理效率，我提供了批量编辑功能，包括批量修改图片的分类、标签、名称等，能安全快速地完成大量图片的更新操作。</p><p>实现过程主要分两步：</p><ol><li>在 Service 中，先一次性查询出要修改的图片并检查权限，然后按需更新分类、标签、名称等字段。</li><li>使用 MyBatis Plus 的 updateBatchById 批量更新记录，结合事务保证原子性。</li></ol><p>通过下面几个方法，可以优化批量编辑的性能：</p><ul><li>减少循环 SQL：统一分批、批量更新数据库，而不是给每张图都执行一条 Update。</li><li>并发执行：如果数据量特别大，可以用 CompletableFuture + 线程池将不同分段的图片并发处理，并在全部处理完后再统一提交或回滚。</li></ul><h4 id="云图库项目的后端中-你如何实现-ai-扩图功能-使用-ai-服务时有哪些注意事项" tabindex="-1"><a class="header-anchor" href="#云图库项目的后端中-你如何实现-ai-扩图功能-使用-ai-服务时有哪些注意事项" aria-hidden="true">#</a> 云图库项目的后端中，你如何实现 AI 扩图功能？使用 AI 服务时有哪些注意事项？</h4><p>我在云图库项目中采用了阿里云百炼的大模型服务来实现 AI 扩图功能，流程如下：</p><p>1）选择 AI 大模型：我调研了很多国内外的 AI 绘画大模型，发现阿里云百炼提供图像扩展 API，可以通过 HTTP 接入并且响应较快，还提供了一定免费额度，所以选择它。</p><p>2）异步调用：该 AI 接口需要先创建任务，然后轮询查看任务状态，又分为 2 个步骤：</p><ol><li>后端调用 AI 的 “创建扩图任务” API，传入原图 URL 及一些扩展参数（如左右、上下加多少像素），得到一个 taskId 。</li><li>前端轮询后端接口，后端再调用 AI “查询任务” 的 API 来判断任务是否完成；如果成功，则返回生成好的图片链接，如果失败则提示用户。</li></ol><p>使用 AI 服务的注意事项：</p><ol><li>成本控制：绘图大模型通常按调用量或 GPU 耗时计费，要在使用前就预估好成本，并且通过记录次数或费用，整体观测成本消耗情况。</li><li>异步调用：大模型绘画任务往往耗时数秒到数十秒，同步等待会堵塞线程、影响并发性能，因此必须采用异步任务 + 前端轮询或后台轮询的方式。</li><li>超时控制：一旦任务执行很久还没完成，需要及时停止轮询，避免资源浪费。</li><li>参数校验：调用 AI 接口前先检查图片大小、格式、空间容量等，减少无意义的请求。</li><li>安全性：AI 接口成本高，必须加限流（如每分钟 N 次）和权限校验，防止恶意刷任务；对异常或失败任务也要做好记录与告警，保证系统稳定。</li></ol><h4 id="云图库项目中-你开发了哪些分析能力-后端如何实现空间分析功能" tabindex="-1"><a class="header-anchor" href="#云图库项目中-你开发了哪些分析能力-后端如何实现空间分析功能" aria-hidden="true">#</a> 云图库项目中，你开发了哪些分析能力？后端如何实现空间分析功能？</h4><p>在云图库项目中，我针对空间和公共图库的图片数据，开发了多种分析能力，包括空间资源使用分析、图片分类与标签分布、图片大小分布统计、用户上传行为分析，以及管理员可用的全局空间排行分析等。</p><p>对于分析类需求，开发流程都是类似的：</p><ol><li>数据采集：从数据源（比如 MySQL 数据库或者大数据仓库）获取原始数据。要提前明确涉及的表和字段，必要时采用分页查询处理大数据量。</li><li>数据预处理：对数据进行清洗、加工和格式化，包括过滤无效数据（比如逻辑删除或审核未通过）、解析复杂字段（比如 JSON 格式的 tags），以及通过字段关联补充上下文信息。</li><li>数据计算：根据需求进行分组、聚合、排序等，从而计算关键指标，比如计算空间各分类图片的占用比例、用户上传图片的时间趋势。可以根据场景调整计算方案，比如对于大数据量的计算，可以采用 Spark 之类的大数据计算组件做离线计算；对于数据实时性要求较高的实时分析场景，可以用 Flink 做流式处理。</li><li>数据存储（可选）：针对频繁查询的分析结果，可将结果数据存储为单独的表或缓存，减少重复计算，提高查询效率。</li><li>数据接口设计：为前端提供统一接口，从而支持查询和展示。需要考虑到数据量较大导致前端渲染卡顿的情况，可以按需精简返回的字符串、分页查询等。</li><li>数据可视化：通过图表直观展示分析结果，前端可以使用 <a href="https://echarts.apache.org/" target="_blank" rel="noopener noreferrer">Apache ECharts<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 等可视化库渲染。当然也可以让后端生成图表图片并返回，但这种实现方法的灵活度有限。</li></ol><p>通过这些分析能力，用户可以清晰掌握自己空间的使用状况和图片分布，管理员也能整体观察系统资源利用率，并做好限额管控和数据运营。如果数据量大，还可进一步用 Redis / 定时任务等手段做缓存或离线计算，提升统计性能与响应速度。</p><h4 id="云图库项目的后端中-你如何实现图片的协同编辑功能" tabindex="-1"><a class="header-anchor" href="#云图库项目的后端中-你如何实现图片的协同编辑功能" aria-hidden="true">#</a> 云图库项目的后端中，你如何实现图片的协同编辑功能？</h4><p>我在已有的图片编辑功能上，结合 <strong>WebSocket</strong> 和 <strong>事件驱动</strong> 思想，让多位团队成员能够实时查看对同一张图片的编辑变化。关键的实现点是：</p><ol><li>WebSocket 通信：前端与后端在建立 WebSocket 连接后，后端保存每个图片对应的会话集合，以及当前正在编辑的用户信息。</li><li>编辑锁机制：只有一个用户可以进入编辑状态，其他用户只能实时 “围观” 该用户操作，这样从源头上解决了并发冲突。</li><li>事件驱动：每当用户执行放大 / 旋转等编辑动作，相当于生产了一个 “事件”，通过 WebSocket 服务器把该事件分发给其他连接用户，实时广播更新。</li><li>断开连接：若正在编辑用户断线或退出，会自动释放编辑锁，其他用户可申请进入编辑状态。</li></ol><h4 id="什么是-websocket-为什么在云图库项目中选用它而不是-http-实现协同编辑" tabindex="-1"><a class="header-anchor" href="#什么是-websocket-为什么在云图库项目中选用它而不是-http-实现协同编辑" aria-hidden="true">#</a> 什么是 WebSocket？为什么在云图库项目中选用它而不是 HTTP 实现协同编辑？</h4><p>WebSocket 是一种 <strong>全双工</strong>（双向）通信协议。和传统 “请求-响应” 的 HTTP 不同，WebSocket 在初次握手后会保留一个持久连接，客户端和服务器可彼此 <strong>随时主动</strong> 发送消息，而无需频繁重建连接。</p><p>在协同编辑场景中，需要 <strong>高频双向</strong> 的消息传输 —— 编辑者的操作需要立刻同步给其他用户。如果用 HTTP 就得不断轮询或发起请求，浪费带宽、且延迟高；而使用 WebSocket 保持长连接，可以低延迟地推送彼此的编辑信息，满足实时协同需求。</p><h4 id="什么是事件驱动设计-你在云图库项目中是如何运用它实现协同编辑功能的" tabindex="-1"><a class="header-anchor" href="#什么是事件驱动设计-你在云图库项目中是如何运用它实现协同编辑功能的" aria-hidden="true">#</a> 什么是事件驱动设计？你在云图库项目中是如何运用它实现协同编辑功能的？</h4><p>事件驱动设计通过将系统内的操作抽象成 “事件”，当事件发生时，把事件交给异步处理器或消息总线，然后通知其他需要接收的组件或用户，从而 <strong>解耦</strong> 生产者与消费者，并提高并发性能。</p><p>在我的协同编辑实现中，每次用户的编辑动作都被视作一个事件：</p><ol><li>WebSocket 接收前端事件后，触发相应的处理器</li><li>处理器中将消息再广播给所有正在编辑此图片的客户端</li><li>其他用户收到此事件后即可同步更新编辑状态和操作</li></ol><h4 id="云图库项目的后端中-websocket-的握手拦截器和编辑锁机制分别起到什么作用" tabindex="-1"><a class="header-anchor" href="#云图库项目的后端中-websocket-的握手拦截器和编辑锁机制分别起到什么作用" aria-hidden="true">#</a> 云图库项目的后端中，WebSocket 的握手拦截器和编辑锁机制分别起到什么作用？</h4><p>1）WebSocket 握手拦截器：在真正建立 WebSocket 长连接前，会进行一次 HTTP Upgrade 请求。我在握手拦截器中校验用户是否已登录、有无团队空间的编辑权限，然后把用户、图片 ID 等信息放到 Session 属性里，这样就能在后续通信中直接复用这些会话属性；如果不符合条件则拒绝握手。</p><p>2）编辑锁机制：同一时刻只有一个用户能 “进入编辑” 该图片，其余用户只能接收消息并实时浏览效果，但不能操作。这样可以从源头避免并发冲突，不需要维护复杂的实时合并算法。当持锁用户退出或断连时自动释放锁，其他人才能进入编辑状态。</p><h4 id="什么是-disruptor-在云图库项目中为什么要使用它-又是如何使用它的" tabindex="-1"><a class="header-anchor" href="#什么是-disruptor-在云图库项目中为什么要使用它-又是如何使用它的" aria-hidden="true">#</a> 什么是 Disruptor？在云图库项目中为什么要使用它？又是如何使用它的？</h4><p>Disruptor 是 LMAX 公司开源的一个 <strong>高性能无锁环形队列</strong> 框架，常用于高并发、低延迟的消息处理场景。它通过环形缓冲区 + 无锁（CAS + 内存屏障）减少线程切换，来显著提升吞吐量。</p><p>在协同编辑中，后端 WebSocket 原本同步接收和处理消息，若并发用户多、单条消息处理耗时长，就易造成阻塞，无法处理更多请求。引入 Disruptor 后，将消息生产与消息处理解耦：</p><ol><li>原本的处理消息逻辑修改为 “仅把消息提交到 Disruptor 队列”</li><li>由 Disruptor 的消费者线程异步取出并执行具体业务逻辑</li></ol><p>这能保持 WebSocket 主线程轻量快速，不易被阻塞，也能提高实时响应能力。</p><p>我在项目中使用 Disruptor 的步骤：</p><ol><li>引入 Disruptor 依赖</li><li>定义事件，承载编辑请求、WebSocket Session、用户信息等</li><li>定义事件处理器，用于消费编辑事件并调用相应的业务逻辑</li><li>在启动时初始化 Disruptor，初始化固定大小的环形队列，并把事件处理器加入消费者池</li><li>在 WebSocket 收到消息后，把它发布到 Disruptor 的环形队列</li><li>Disruptor 内部会多线程异步执行这些事件</li></ol><h4 id="什么是优雅停机-你在云图库项目中怎么利用-disruptor-实现优雅停机" tabindex="-1"><a class="header-anchor" href="#什么是优雅停机-你在云图库项目中怎么利用-disruptor-实现优雅停机" aria-hidden="true">#</a> 什么是优雅停机？你在云图库项目中怎么利用 Disruptor 实现优雅停机？</h4><p>优雅停机指在应用关闭前，<strong>不再接收新的请求</strong> 并 <strong>等待系统中正在进行的任务全部完成后</strong>，才真正停止进程。这样可以确保数据或状态不会在停机时刻中断或丢失，避免产生乱序或资源泄露等问题。</p><p>Disruptor 本身提供了优雅停机方法。我利用 Bean 的 PreDestroy 注解，在应用关闭前，先调用 <code>disruptor.shutdown()</code>，然后 Disruptor 本身会等待环形队列内的所有事件处理完才返回，同时拒绝新的编辑操作或网络请求。待队列任务都消费完成，再关闭线程池和资源连接，最后退出应用。</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/tim-qtp/blog/edit/main/demo/theme-docs/src/projectessay/practicalProjects/imageLibrary/12.Miscellaneous.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 2469100031@qq.com">tim-qtp</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/blog/projectessay/practicalProjects/imageLibrary/11.Collaborative%20photo%20editing.html" class="nav-link prev" aria-label="图片协同编辑"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->图片协同编辑</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2025 tim-qtp</div></footer></div><!--]--><!----><!----><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-72d4e7e3.js" defer></script>
  </body>
</html>
