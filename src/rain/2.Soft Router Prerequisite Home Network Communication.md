---
order: 2
author: 
title: "软路由指南"
category:
  - 软路由
  - OpenClash

---

### Highlights

- 什么是软路由？🛠️
- 软路由相较硬路由的优势⚙️
- 常见软路由系统介绍📦
- 刷入OpenWRT固件的方法📲
- 配置OpenWRT的步骤🖥️
- 科学上网工具及设置🕵️
- 网络问题及解决方案🔧

### OpenWrt/ImmortalWrt

固件选择器：[https://firmware-selector.immortalwrt.org](https://firmware-selector.immortalwrt.org)

自定义构建参考Package：

[https://downloads.immortalwrt.org/releases/23.05.1/packages/x86_64/luci/Packages](https://downloads.immortalwrt.org/releases/23.05.1/packages/x86_64/luci/Packages)

OpenWrt支持的设备：[https://openwrt.org/toh/start](https://openwrt.org/toh/start)

英特尔CPU性能对比：[https://www.intel.cn/content/www/cn/zh/search.html](https://www.intel.cn/content/www/cn/zh/search.html)

### 1. **什么是软路由？**
- **软路由**是指可以安装软件的路由器，它不一定是传统意义上的路由器，可能是一台迷你PC、工控小主机、开发板，甚至是闲置的笔记本电脑。
- 与**硬路由**（功能固化的家用路由器）不同，软路由可以安装各种路由系统（如**OpenWrt**、PFsense、RouterOS、iKuai、梅林等），并支持丰富的插件扩展功能。

### 2. **为什么需要软路由？**

- **科学上网**：软路由可以在路由器层面运行代理工具（如v2ray、Clash等），使所有连接到路由器的设备都能自动科学上网，无需在每个设备上单独配置代理。
- **解决设备限制**：某些设备（如电视盒子、VR头显）无法直接运行代理工具，软路由可以绕过这些限制，让这些设备也能访问被墙的网站。
- **功能扩展**：软路由支持安装各种插件，提供比硬路由更强大的功能，如广告过滤、流量监控、虚拟化等。

### 3. **软路由的应用场景**

- **家庭网络**：通过软路由实现全家设备的科学上网，解决电视盒子、VR设备等无法直接使用代理工具的问题。
- **跨境电商**：对于需要管理多台设备的用户（如群控），软路由可以简化科学上网的配置。
- **网络优化**：软路由支持多种网络优化功能，如负载均衡、流量控制等。

### 5. **软路由的系统安装**

- **固件获取**：可以通过官方OpenWRT、immortalWRT等获取固件，immortalWRT提供了丰富的插件支持。
- **刷机工具**：使用Rufus（Windows）或 BalenaEtcher（Mac/Linux）将固件写入SD卡或U盘。
- **系统启动**：将写入固件的SD卡或U盘插入设备，启动后即可进入OpenWRT系统。

**下面开始实际操作一下：**

我这里选择`OpenWrt`，它是个开源免费的路由系统，提供了完整的路由功能，并且可以安装各式各样的插件，最主要的是安装代理插件（`OpoenClash`），实现全家科学上网。

我们需要先确定，什么样的设备能够运行`op`系统，这里说的设备，是指不同`SoC`平台的嵌入式设备，主要指的是硬路由，像X86这种通用平台不用担心这个问题。简单理解。除了电脑，你家其他所有带程序控制的设备，都算是嵌入式设备，比如冰箱、空调、洗衣机、电视、音响、路由器等等。

如果你有一条闲置的路由器，想看看能不能刷op，最简单的方式就是去官网查看。

OpenWrt支持的设备：[https://openwrt.org/toh/start](https://bulianglin.com/g/aHR0cHM6Ly9vcGVud3J0Lm9yZy90b2gvc3RhcnQ)

以本人接触过的设备为例：

- 价格250的友善nanopi r2s开发板
- 和价格350的红米ax6000硬路由
- 以及价格850的某杂牌X86小主机

![](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/image-20250116171131374.png)

这三款机器都能跑满千兆带宽，科学上网能跑500m，具体要看你的节点速度，对大部分人来说性能过剩了。

R2S颜值高，价格低，可以说就是为软路由而生的，缺点就是SoC属于RAM架构，不能说是缺点，只是很多软件和系统仅提供x86架构的版本，无法在arm架构的机器上运行，所以局限性比较大，但如果你只用来当路由科学上网不折腾的话足够了。

设备有了，接下来就要给他安装openwrt系统了，获取适合你设备的固件主要有三种途径，第一种方式最简单，使用网上别人编译好的op固件，他们在编译的时候会内置各种插件，你要做的就是下载他的固件，刷入之后就能直接用了，非常方便省事。

但缺点也很明显，为了尽量满足所有人，作者会编译大量你可能永远都不会点开的插件，显得系统很臃肿，最重要的是刷别人的固件存在安全风险，可能夹带了私货，跑他的脚本，收集你的信息，甚至给你安装“有主机上线”也说不定，所以我不推荐这种方式，你要用的话建议找你信得过的人编译的固件。

第二种方式就是自己编译固件，你想要啥插件就编译啥，最大程度满足你的需求，编译也很简单，网上有很多教程，跟着一步步操作就行了，虽然各位前辈将编译固件的难度降低到了小白就能操作的水平，但过程还是非常繁琐的。

第三种方式，也是我比较推荐的方式，直接使用官方固件，openwrt每次发布新的版本都会给所有支持的设备编译一个最小系统固件以及对应的软件源，该固件没有携带任何第三方插件，非常纯净，所以只能满足最基本的路由器功能，可以通过安装官方源里的插件添加新功能，但遗憾的是官方源有点过于纯净了，插件很少，四舍五入一下约等于没有，所以我这里推荐大家使用openwrt的分支项目，`ImmortalWrt`，以下简称imm，imm同样是免费开源的，与官方openwrt的主要区别在于，Imm的软件源提供了**大量常用的第三方插件**，并且提供了**cdn加速的镜像源**，可以非常方便的安装和管理插件。

接下来就是刷入`ImmortalWrt`的纯净op固件，配置好网络并且安装插件实现科学上网。

![ImmortalWrt](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/image-20250116180729174.png)

我这里选最新的，实际上作为一个路由器，应该以稳定为主，不宜追新，并且23版对比21版有个非常巨大的改变，配置防火墙的工具从`iptables`变成了`nftables`，有些插件还没有添加对`nftables`的支持，比如`ssrp`。

<img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/image-20250116181008818.png" alt="image-20250116181008818" style="zoom:33%;" />

并且已经支持`nftables`的插件也可能存在兼容性问题。

`ImmortalWrt`里面输入你的设备型号，官方支持的设备这里都有，比如r2s，只有一个结果，下方有两个不同文件系统格式的固件，`EXT4`和`SQUASHFS`，主要的区别是`SQUASHFS`格式修改的配置文件会写入到挂载的`overlay`分区里，而不是覆盖原来rom的文件，所以这种格式可以通过抹除`overlay`分区达到恢复出厂设置的效果。

![](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/image-20250116183038007.png)

`EXT4`的话没有这种机制，所以不能恢复出厂设置

![](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/image-20250116183213035.png)

按你的需求选择即可。

除了使用`imm`预编译好的op固件，我们也可以点击这里使用网站提供的`Imagebuilder`在线自定义编译固件，可以在这里设置你要编译到固件里的插件，输入框里的是默认需要编译的，保证最小系统能够正常提供路由功能，**一般不要去动它**，除非你明确知道自己的需求，比如你确定你不需要`PPPoP`拨号，就可以把这两个删了，不需要`ipv6`，就可以把ipv6相关组件删掉，如果想要添加插件，你需要先知道插件的完整包名，可以进入这个链接查看luci[包名](https://downloads.immortalwrt.org/releases/23.05.1/packages/x86_64/luci/Packages)，比如我要安装`OpenClash`，那么他的完整包名就是`luci-app-openclash`，将其添加到预安装列表，可以添加多个，注意用空格隔开。

下方还可以设置固件安装之后首次开机运行的脚本，比如修改LAN的ip地址，设置`PPPoP`的账号密码等等，配置好之后就可以请求构建了，这样就会利用imm服务器的计算资源帮我们编译固件了，可以说是非常方便。

但是除非你有很多机器要定制化安装，否则不建议使用该功能。因为本来就只能添加imm软件源里有的插件，而这些插件都能在刷好纯净固件之后直接安装，没必要先编译进去，再者编译也需要时间，你还得等，也可能会出错导致编译失败，所以建议直接下载imm提供的纯净固件，编译好之后可以在这里查看编译过程中的日志输出，在下方下载刚才生成的自定义固件。

接着演示`x86`固件，目前你能买到的都是64位的cpu指令集架构，`x86`提供了非常多的固件类型，很多都是给虚拟机用的，我们主要看结尾是`img.gz`的文件，比如第一个就是。

`EXT4`表示文件系统格式，刚才讲过与之对应的是`squashfs`，`combined`译为组合，**表示内核与根文件系统都在固件里**，`efi`是引导类型，或者叫`uefi`，近些年的主板都支持`efi`引导，后面的img就是固件的格式，`gz`就表示这是一个压缩文件，这是我们需要的，点击下载，下方还提供了非`efi`引导的固件，也就是传统的`Legacy`引导，如果你的主板不支持`efi`引导的话就刷这个，不确定的话也可以直接刷这个。

再下方的话就是`squashfs`的文件系统，也就是支持恢复出厂设置的格式，按需选择即可，同样`squashfs`也提供了非`efi`的`Legacy`引导固件。

`img`固件里面就是一个完整的`openwrt`系统，我们要做的就是将内容完整的拷贝到你的u盘或者sd卡里，这个操作也叫写盘，`arm`小主机一般都是使用sd卡当作硬盘，而`x86`小主机可以在机器内部安装硬盘，也可以通过修改启动引导用U盘当作系统盘。



常见的写盘工具，首先最推荐的就是这个[rufus](https://rufus.ie/zh/)，非常小巧，只有1.4M大小，不过只支持windows，下载这个p版，也就是便携版。

操作非常简单，先以arm小主机R2S为例，将你的sd读卡器插入电脑的usb接口，软件会自动识别，然后将你需要刷入的固件拖入软件界面任意位置，可以直接拖入gz压缩包文件，无需解压，然后直接点击开始。

![Rufus](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/image-20250116192927399.png)

注意确认设备是不是你插入的sd卡，里面的分区信息和数据全部都会被抹掉，注意提前做好备份。

等待进度条走完之后就刷入成功了，此时你的sd卡里面就有一个`OpenWrt`的操作系统了，接着插入`R2S`，通电开机，就会自动启动`OpenWrt`系统了.

虽然没法接显示器，但相信我openwrt已经运行！

其实不用担心sd卡影响系统运行速度，开机后系统会被加载到内存里运行，不是运行在sd卡里，除非你要进行高强度的文件读写操作，否则是不会影响系统运行速度的。



### 6. **软路由的配置**
- **网络配置**：设置LAN口和WAN口，确保软路由能够正常连接互联网。
- **关闭IPv6**：为了避免透明代理中的问题，建议关闭IPv6。
- **插件安装**：通过immortalWRT的软件源安装各种插件，如OpenClash、Passwall、HomeProxy等，实现科学上网。

### 7. **科学上网插件的使用**
- **Passwall**：支持节点订阅和手动添加节点，配置简单，适合初学者。
- **HomeProxy**：基于sing-box内核，支持多种协议，适合高级用户。
- **OpenClash**：功能强大，支持Clash内核，适合需要精细控制节点的用户。

### 8. **软路由的网络拓扑**
- **主路由模式**：软路由作为家庭网络的主路由，负责拨号和NAT，所有设备通过软路由上网。
- **旁路由模式**：软路由作为旁路由，只负责科学上网，主路由仍然负责拨号和NAT。

