---
order: 2
author: 
title: "åå°„"
category:
  - JavaåŸºç¡€
---



**ğŸ“Œ åå°„ï¼ˆReflectionï¼‰** å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶ åŠ¨æ€è·å–ç±»çš„ä¿¡æ¯ã€åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•ã€ä¿®æ”¹å­—æ®µï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶å†™æ­»ä»£ç ã€‚



## **1. ä¸ºä»€ä¹ˆè¦ç”¨åå°„ï¼Ÿ**

é€šå¸¸ï¼Œåœ¨ç¼–å†™ Java ä»£ç æ—¶ï¼Œæˆ‘ä»¬éƒ½æ˜¯è¿™æ ·è°ƒç”¨ç±»çš„æ–¹æ³•çš„ï¼š

```
javaå¤åˆ¶ç¼–è¾‘Person p = new Person();
p.sayHello();
```

è¿™é‡Œï¼Œ`Person` ç±»çš„ `sayHello()` æ–¹æ³•æ˜¯**åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šçš„**ã€‚

ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ï¼š

1. **åœ¨è¿è¡Œæ—¶**æ‰å†³å®šè¦è°ƒç”¨å“ªä¸ªç±»çš„æ–¹æ³•ï¼ˆæ¯”å¦‚ä»é…ç½®æ–‡ä»¶è¯»å–ç±»åå’Œæ–¹æ³•åï¼‰ã€‚
2. **è·å–ç±»çš„ä¿¡æ¯**ï¼Œæ¯”å¦‚æŸ¥çœ‹å®ƒçš„å±æ€§ã€æ–¹æ³•ç­‰ã€‚
3. **åˆ›å»ºå¯¹è±¡**ï¼Œè€Œä¸ç›´æ¥ä½¿ç”¨ `new` å…³é”®å­—ã€‚

è¿™æ—¶å€™ï¼Œåå°„å°±æ´¾ä¸Šç”¨åœºäº†ã€‚

------

## **2. åå°„çš„åŸºæœ¬æ“ä½œ**

### **2.1 è·å– `Class` å¯¹è±¡**

åœ¨ Java åå°„ä¸­ï¼Œ**æ‰€æœ‰çš„ç±»ä¿¡æ¯éƒ½ç”± `Class` å¯¹è±¡è¡¨ç¤º**ï¼Œè·å– `Class` å¯¹è±¡æœ‰ä¸‰ç§æ–¹å¼ï¼š

```java
// æ–¹å¼ 1ï¼šé€šè¿‡ Class.forName("ç±»çš„å…¨é™å®šå")
Class<?> clazz1 = Class.forName("com.example.Person");

// æ–¹å¼ 2ï¼šé€šè¿‡ ç±»å.class
Class<?> clazz2 = Person.class;

// æ–¹å¼ 3ï¼šé€šè¿‡ å¯¹è±¡.getClass()
Person p = new Person();
Class<?> clazz3 = p.getClass();
```

æ— è®ºå“ªç§æ–¹å¼ï¼Œ`clazz1`ã€`clazz2` å’Œ `clazz3` éƒ½æŒ‡å‘ `Person` ç±»çš„ `Class` å¯¹è±¡ã€‚

------

### **2.2 é€šè¿‡åå°„åˆ›å»ºå¯¹è±¡**

ä½¿ç”¨ `newInstance()` åˆ›å»ºå¯¹è±¡ï¼š

```java
Class<?> clazz = Class.forName("com.example.Person");
Object obj = clazz.getDeclaredConstructor().newInstance(); // ç­‰ä»·äº new Person()
```

------

### **2.3 é€šè¿‡åå°„è°ƒç”¨æ–¹æ³•**

```java
javaå¤åˆ¶ç¼–è¾‘import java.lang.reflect.Method;

class Person {
    public void sayHello() {
        System.out.println("Hello, Java Reflection!");
    }
}

public class ReflectionDemo {
    public static void main(String[] args) throws Exception {
        // è·å– Class å¯¹è±¡
        Class<?> clazz = Class.forName("Person");

        // åˆ›å»ºå¯¹è±¡
        Object obj = clazz.getDeclaredConstructor().newInstance();

        // è·å–æ–¹æ³•
        Method method = clazz.getMethod("sayHello");

        // è°ƒç”¨æ–¹æ³•
        method.invoke(obj); // è¾“å‡ºï¼šHello, Java Reflection!
    }
}
```

è¿™é‡Œï¼š

1. `clazz.getMethod("sayHello")` è·å– `sayHello()` æ–¹æ³•ã€‚
2. `method.invoke(obj)` åœ¨ `obj` ä¸Šæ‰§è¡Œè¯¥æ–¹æ³•ã€‚

------

### **2.4 é€šè¿‡åå°„è®¿é—®å­—æ®µï¼ˆå±æ€§ï¼‰**

```java
javaå¤åˆ¶ç¼–è¾‘import java.lang.reflect.Field;

class Person {
    private String name = "John";
}

public class ReflectionDemo {
    public static void main(String[] args) throws Exception {
        Class<?> clazz = Class.forName("Person");
        Object obj = clazz.getDeclaredConstructor().newInstance();

        // è·å– private å­—æ®µ
        Field field = clazz.getDeclaredField("name");
        field.setAccessible(true); // å…è®¸è®¿é—®ç§æœ‰å­—æ®µ
        System.out.println("ä¿®æ”¹å‰: " + field.get(obj)); // John

        // ä¿®æ”¹å­—æ®µçš„å€¼
        field.set(obj, "Alice");
        System.out.println("ä¿®æ”¹å: " + field.get(obj)); // Alice
    }
}
```

------

## **3. åå°„çš„åº”ç”¨åœºæ™¯**

### **3.1 æ¡†æ¶çš„åº•å±‚å®ç°**

Java çš„è®¸å¤šæ¡†æ¶ï¼ˆSpringã€Hibernate ç­‰ï¼‰éƒ½å¤§é‡ä½¿ç”¨äº†åå°„ï¼Œæ¯”å¦‚ï¼š

- Springæ¡†æ¶

  **Spring IoC**ï¼ˆæ§åˆ¶åè½¬ï¼‰ï¼šåå°„åˆ›å»º Bean å¹¶è‡ªåŠ¨æ³¨å…¥ä¾èµ–ï¼ˆ@Autowiredï¼‰ã€‚

  **Spring AOP**ï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ï¼šåå°„æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼ˆ@Transactionalã€@Logï¼‰ã€‚

  **Spring MVC**ï¼šåå°„è§£æ `@RequestMapping` ç»‘å®š URL å’Œæ–¹æ³•ã€‚

- **JUnit** é€šè¿‡åå°„æ‰§è¡Œæµ‹è¯•æ–¹æ³•ã€‚

#### **ğŸ“Œ ä¾‹å­ï¼šæ¨¡æ‹Ÿ Spring çš„ @Autowired è‡ªåŠ¨æ³¨å…¥**

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ï¼š

1. è§£æç±»ä¸­çš„ `@Autowired` æ³¨è§£ã€‚
2. é€šè¿‡åå°„è‡ªåŠ¨æ³¨å…¥ä¾èµ–ï¼Œè€Œä¸éœ€è¦ `new` å…³é”®å­—ã€‚
3. æ¨¡æ‹Ÿ Spring ä¾èµ–æ³¨å…¥çš„æœºåˆ¶ã€‚

#### **1ï¸âƒ£ åˆ›å»º `@Autowired` æ³¨è§£**

Spring ä¸­çš„ `@Autowired` ä¸»è¦ç”¨äºè‡ªåŠ¨æ³¨å…¥ä¾èµ–ï¼Œæˆ‘ä»¬è‡ªå·±å®šä¹‰ä¸€ä¸ªç±»ä¼¼çš„æ³¨è§£ï¼š

```java
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

// ä½œç”¨äºå­—æ®µ
@Target(ElementType.FIELD)
// è¿è¡Œæ—¶ä¿ç•™
@Retention(RetentionPolicy.RUNTIME)
public @interface Autowired {
}
```

#### **2ï¸âƒ£ å®šä¹‰ä¸šåŠ¡ç±»**

æ¨¡æ‹Ÿä¸€ä¸ªåç«¯å¼€å‘ä¸­å¸¸è§çš„**Service å’Œ DAO å±‚**ï¼š

```java
// æ•°æ®è®¿é—®å±‚
public class UserRepository {
    public String getUser() {
        return "Hello, Java Backend!";
    }
}

// ä¸šåŠ¡é€»è¾‘å±‚
public class UserService {
    @Autowired // ä¾èµ–æ³¨å…¥
    private UserRepository userRepository;

    public void printUser() {
        System.out.println(userRepository.getUser());
    }
}
```

- `UserRepository` è´Ÿè´£è®¿é—®æ•°æ®åº“ï¼ˆè¿™é‡Œç®€åŒ–ï¼‰ã€‚
- `UserService` ä¾èµ– `UserRepository`ï¼Œä½†æ²¡æœ‰æ‰‹åŠ¨ `new`ï¼Œè€Œæ˜¯ç”¨ `@Autowired` æ ‡è®°ã€‚

#### **3ï¸âƒ£ é€šè¿‡åå°„å®ç°è‡ªåŠ¨ä¾èµ–æ³¨å…¥**

```java
import java.lang.reflect.Field;

public class IoCContainer {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»º UserService å®ä¾‹
        UserService userService = new UserService();

        // 2. å¤„ç† @Autowired æ³¨è§£ï¼Œå®ç°è‡ªåŠ¨æ³¨å…¥
        injectDependencies(userService);

        // 3. è°ƒç”¨æ–¹æ³•ï¼ŒéªŒè¯ä¾èµ–æ˜¯å¦è¢«æ³¨å…¥
        userService.printUser(); // è¾“å‡º: Hello, Java Backend!
    }

    // åå°„æ‰«æ @Autowired å­—æ®µï¼Œå¹¶è¿›è¡Œä¾èµ–æ³¨å…¥
    private static void injectDependencies(Object obj) throws Exception {
        Class<?> clazz = obj.getClass(); // è·å–ç±»å¯¹è±¡ï¼Œè¿™é‡Œè·å–åˆ°çš„æ˜¯UserService

        for (Field field : clazz.getDeclaredFields()) { // éå†æ‰€æœ‰å­—æ®µ
            if (field.isAnnotationPresent(Autowired.class)) { // å¦‚æœå­—æ®µæœ‰ @Autowired æ³¨è§£
                field.setAccessible(true); // å…è®¸è®¿é—®ç§æœ‰å­—æ®µ
                Object dependency = field.getType().getDeclaredConstructor().newInstance(); // åˆ›å»ºä¾èµ–å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯UserRepository
                field.set(obj, dependency); // æ³¨å…¥åˆ°å½“å‰å¯¹è±¡ä¸­
            }
        }
    }
}
```

#### **4ï¸âƒ£ è¿è¡Œæ•ˆæœ**

```sh
Hello, Java Backend!
```

**âœ… `UserService` è‡ªåŠ¨æ³¨å…¥äº† `UserRepository`ï¼Œæ— éœ€æ‰‹åŠ¨ newï¼**

#### **ğŸ” è§£æï¼šåå°„åšäº†ä»€ä¹ˆï¼Ÿ**

1. **è·å–ç±»çš„æ‰€æœ‰å­—æ®µ**ï¼š`clazz.getDeclaredFields()`
2. **åˆ¤æ–­å­—æ®µæ˜¯å¦æœ‰ `@Autowired` æ³¨è§£**ï¼š`field.isAnnotationPresent(Autowired.class)`
3. **åˆ›å»ºä¾èµ–å¯¹è±¡**ï¼ˆåå°„è°ƒç”¨æ„é€ æ–¹æ³•ï¼‰ï¼š`field.getType().getDeclaredConstructor().newInstance()`
4. **è®¾ç½®å­—æ®µçš„å€¼**ï¼ˆç»•è¿‡ private é™åˆ¶ï¼‰ï¼š`field.set(obj, dependency)`

è¿™å°±æ˜¯ **Spring IoC ä¾èµ–æ³¨å…¥** çš„æ ¸å¿ƒåŸç†ä¹‹ä¸€ï¼



### **3.2 è¯»å–é…ç½®æ–‡ä»¶åŠ¨æ€åˆ›å»ºå¯¹è±¡**

å‡è®¾æˆ‘ä»¬æœ‰ä¸ª `config.properties`ï¼š

```properties
className=com.example.Person
methodName=sayHello
```

ç„¶åé€šè¿‡åå°„åŠ¨æ€åŠ è½½ï¼š

```java
import java.io.InputStream;
import java.lang.reflect.Method;
import java.util.Properties;

public class ReflectionConfig {
    public static void main(String[] args) throws Exception {
        // è¯»å–é…ç½®æ–‡ä»¶
        Properties props = new Properties();
        InputStream is = ReflectionConfig.class.getClassLoader().getResourceAsStream("config.properties");
        props.load(is);

        // è·å–ç±»åå’Œæ–¹æ³•å
        String className = props.getProperty("className");
        String methodName = props.getProperty("methodName");

        // åå°„åˆ›å»ºå¯¹è±¡å¹¶è°ƒç”¨æ–¹æ³•
        Class<?> clazz = Class.forName(className);
        Object obj = clazz.getDeclaredConstructor().newInstance();
        Method method = clazz.getMethod(methodName);
        method.invoke(obj);
    }
}
```

è¿™æ ·ï¼Œæˆ‘ä»¬**ä¸éœ€è¦ä¿®æ”¹ä»£ç **ï¼Œåªè¦æ”¹ `config.properties` å°±å¯ä»¥è°ƒç”¨ä¸åŒçš„ç±»å’Œæ–¹æ³•ã€‚