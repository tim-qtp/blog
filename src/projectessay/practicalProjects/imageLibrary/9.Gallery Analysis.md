---
order: 9
author: 
title: "å›¾åº“åˆ†æ"
category:
  - äº‘å›¾åº“
  - é¡¹ç›®
---

  - ç”¨æˆ·ç©ºé—´å›¾åº“åˆ†æ
  - ç®¡ç†å‘˜å…¨ç©ºé—´åˆ†æ

## ä¸€ã€éœ€æ±‚åˆ†æï¼š

### 1ã€ç”¨æˆ·ç©ºé—´å›¾åº“åˆ†æ

ç”¨æˆ·å¯ä»¥å¯¹è‡ªå·±çš„ç©ºé—´å›¾åº“è¿›è¡Œåˆ†æï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé‡ç‚¹åŠŸèƒ½ï¼š

1ï¼‰ç©ºé—´èµ„æºä½¿ç”¨åˆ†æï¼šé€šè¿‡ç»Ÿè®¡å½“å‰ç©ºé—´å·²ä½¿ç”¨å¤§å°ä¸æ€»é…é¢çš„æ¯”ä¾‹ï¼Œä»¥åŠå›¾ç‰‡æ•°é‡ä¸æœ€å¤§å…è®¸æ•°é‡çš„å æ¯”ï¼Œå¸®åŠ©ç”¨æˆ·ç›´è§‚äº†è§£ç©ºé—´ä½¿ç”¨çŠ¶æ€ï¼ŒåŠæ—¶æ¸…ç†æˆ–å‡çº§ç©ºé—´ã€‚å›¾è¡¨å½¢å¼æ¨èä½¿ç”¨ **ä»ªè¡¨ç›˜**ï¼Œç±»ä¼¼è¿›åº¦æ¡ï¼Œå¯ä»¥æ›´ç›´è§‚åœ°äº†è§£æ¯”ä¾‹ã€‚

![](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503220107901.png)

2ï¼‰ç©ºé—´å›¾ç‰‡åˆ†ç±»åˆ†æï¼šç»Ÿè®¡ä¸åŒåˆ†ç±»ä¸‹å›¾ç‰‡çš„æ•°é‡å’Œæ€»å¤§å°å æ¯”ï¼Œå¸®åŠ©ç”¨æˆ·æ¸…æ™°äº†è§£å„åˆ†ç±»çš„èµ„æºåˆ†å¸ƒï¼Œä¼˜åŒ–å­˜å‚¨ç­–ç•¥ã€‚ç”±äºåŒä¸€ä¸ªåˆ†ç±»è¦å±•ç¤ºå¤šä¸ªä¿¡æ¯ï¼Œå¯ä»¥é€‰æ‹© **åˆ†ç»„æ¡å½¢å›¾** æ¥å±•ç¤ºã€‚

![](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503220102208.png)

3ï¼‰ç©ºé—´å›¾ç‰‡æ ‡ç­¾åˆ†æï¼šè§£æç”¨æˆ·å›¾åº“ä¸­çš„æ ‡ç­¾ï¼Œç»Ÿè®¡æ¯ä¸ªæ ‡ç­¾çš„å…³è”å›¾ç‰‡æ•°é‡ã€‚ç”±äºæ ‡ç­¾æ¯”è¾ƒå¤šï¼Œå¯ä»¥ç”¨ **è¯äº‘å›¾** å±•ç¤ºæ‰€æœ‰çš„æ ‡ç­¾ï¼Œå¹¶çªå‡ºå¸¸ç”¨æ ‡ç­¾ï¼Œä¾¿äºä¼˜åŒ–ç®¡ç†å’Œå›¾ç‰‡æœç´¢ã€‚

![](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503220103336.png)

4ï¼‰ç©ºé—´å›¾ç‰‡å¤§å°åˆ†æï¼šæŒ‰å›¾ç‰‡å¤§å°ï¼ˆå¦‚ <100 KBã€100 KB-1 MBã€>1 MBï¼‰åˆ†æ®µç»Ÿè®¡å›¾ç‰‡æ•°é‡ï¼Œå¸®åŠ©ç”¨æˆ·è¯†åˆ«å¤§ä½“ç§¯å›¾ç‰‡ï¼Œåˆç†åˆ†é…å­˜å‚¨èµ„æºã€‚ç”±äºæŒ‰å›¾ç‰‡å¤§å°åˆ†ç±»çš„æ•°é‡ä¸å¤šï¼Œå¯ä»¥ä½¿ç”¨ **é¥¼å›¾** å±•ç¤ºï¼Œèƒ½å¤Ÿä½“ç°æ¯ç±»å¤§å°å›¾ç‰‡çš„æ•°é‡å æ¯”ã€‚

![](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503220104852.png)

5ï¼‰ç”¨æˆ·ä¸Šä¼ è¡Œä¸ºåˆ†æï¼šç»Ÿè®¡ç”¨æˆ·æ¯æœˆã€æ¯å‘¨ã€æ¯æ—¥ä¸Šä¼ å›¾ç‰‡çš„æ•°é‡è¶‹åŠ¿ï¼Œå¸®åŠ©ç”¨æˆ·è¯†åˆ«ä¸Šä¼ é«˜å³°æœŸå¹¶ä¼˜åŒ–ç®¡ç†ç­–ç•¥ï¼ˆè™½ç„¶å¯¹ç›®å‰è¿™ä¸ªé˜¶æ®µæ²¡æœ‰ç”¨ï¼Œä½†ä¹‹åè¦å¼€å‘å›¢é˜Ÿç©ºé—´ï¼Œå¯ä»¥ç»™å›¢é˜Ÿç®¡ç†å‘˜ä½¿ç”¨ï¼‰ã€‚ä½¿ç”¨ **æŠ˜çº¿å›¾** å‘ˆç°æ—¶é—´åºåˆ—è¶‹åŠ¿ã€‚

![](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503220105762.png)

### 2ã€ç®¡ç†å‘˜å…¨ç©ºé—´åˆ†æ

ç®¡ç†å‘˜å…¨ç©ºé—´åˆ†æçš„æ ¸å¿ƒæ˜¯é¢å‘å…¬å…±å›¾åº“ã€ä»¥åŠæ‰€æœ‰ç”¨æˆ·ç©ºé—´çš„ç»Ÿè®¡å’Œç®¡ç†ï¼š

1ï¼‰å…¨ç©ºé—´èµ„æºä½¿ç”¨åˆ†æï¼šç»Ÿè®¡å…¬å…±å›¾åº“ã€ä»¥åŠç³»ç»Ÿå†…æ‰€æœ‰ç©ºé—´çš„æ€»å­˜å‚¨é‡å’Œæ€»å›¾ç‰‡æ•°ï¼Œå¹¶ä¸”ä¹Ÿæ”¯æŒä»»æ„ç©ºé—´çš„å›¾ç‰‡åˆ†ç±»ã€å›¾ç‰‡æ ‡ç­¾ã€å›¾ç‰‡å¤§å°ã€ç”¨æˆ·ä¸Šä¼ è¡Œä¸ºçš„åˆ†æï¼Œä¾¿äºç®¡ç†å‘˜äº†è§£ç³»ç»Ÿèµ„æºåˆ†é…å’Œåˆ©ç”¨æƒ…å†µã€‚

**å…¶å®è·Ÿç”¨æˆ·åˆ†æè‡ªå·±ç©ºé—´çš„éœ€æ±‚ä¸€è‡´ï¼Œåªä¸è¿‡åˆ†æçš„èŒƒå›´æ›´å¤§ç½¢äº†ã€‚**

2ï¼‰ç©ºé—´ä½¿ç”¨æ’è¡Œåˆ†æï¼šæŒ‰å­˜å‚¨ä½¿ç”¨é‡æ’åºï¼Œç»Ÿè®¡å ç”¨å­˜å‚¨æœ€å¤šçš„å‰ N ä¸ªç©ºé—´ï¼Œå¸®åŠ©ç®¡ç†å‘˜å¿«é€Ÿå®šä½é«˜å ç”¨ç©ºé—´ï¼Œå¹¶è¯†åˆ«æ½œåœ¨çš„èµ„æºæ»¥ç”¨æˆ–å¼‚å¸¸æƒ…å†µã€‚å¯ä»¥é€‰ç”¨ **æŸ±çŠ¶å›¾**ï¼Œç›´è§‚åœ°å±•ç¤ºæ’åå’Œå­˜å‚¨ä½¿ç”¨é‡ã€‚

![](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503220110658.png)

## äºŒã€éœ€æ±‚åˆ†æï¼š

### 1ã€åˆ†æç±»éœ€æ±‚çš„å®ç°æµç¨‹

å¯¹äºåˆ†æç±»éœ€æ±‚ï¼Œå®ç°æµç¨‹å‡ ä¹éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒåŒ…æ‹¬ï¼š

1. æ•°æ®é‡‡é›†ï¼šä»æ•°æ®æºï¼ˆæ¯”å¦‚ MySQL æ•°æ®åº“æˆ–è€…å¤§æ•°æ®ä»“åº“ï¼‰è·å–åŸå§‹æ•°æ®ã€‚è¦æå‰æ˜ç¡®æ¶‰åŠçš„è¡¨å’Œå­—æ®µï¼Œå¿…è¦æ—¶é‡‡ç”¨åˆ†é¡µæŸ¥è¯¢å¤„ç†å¤§æ•°æ®é‡ã€‚
2. æ•°æ®é¢„å¤„ç†ï¼šå¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ã€åŠ å·¥å’Œæ ¼å¼åŒ–ï¼ŒåŒ…æ‹¬è¿‡æ»¤æ— æ•ˆæ•°æ®ï¼ˆæ¯”å¦‚é€»è¾‘åˆ é™¤æˆ–å®¡æ ¸æœªé€šè¿‡ï¼‰ã€è§£æå¤æ‚å­—æ®µï¼ˆæ¯”å¦‚ JSON æ ¼å¼çš„ tagsï¼‰ï¼Œä»¥åŠé€šè¿‡å­—æ®µå…³è”è¡¥å……ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
3. æ•°æ®è®¡ç®—ï¼šæ ¹æ®éœ€æ±‚è¿›è¡Œåˆ†ç»„ã€èšåˆã€æ’åºç­‰ï¼Œä»è€Œè®¡ç®—å…³é”®æŒ‡æ ‡ï¼Œæ¯”å¦‚è®¡ç®—ç©ºé—´å„åˆ†ç±»å›¾ç‰‡çš„å ç”¨æ¯”ä¾‹ã€ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡çš„æ—¶é—´è¶‹åŠ¿ã€‚å¯ä»¥æ ¹æ®åœºæ™¯è°ƒæ•´è®¡ç®—æ–¹æ¡ˆï¼Œæ¯”å¦‚å¯¹äºå¤§æ•°æ®é‡çš„è®¡ç®—ï¼Œå¯ä»¥é‡‡ç”¨ Spark ä¹‹ç±»çš„å¤§æ•°æ®è®¡ç®—ç»„ä»¶åšç¦»çº¿è®¡ç®—ï¼›å¯¹äºæ•°æ®å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„å®æ—¶åˆ†æåœºæ™¯ï¼Œå¯ä»¥ç”¨ Flink åšæµå¼å¤„ç†ã€‚
4. æ•°æ®å­˜å‚¨ï¼ˆå¯é€‰ï¼‰ï¼šé’ˆå¯¹é¢‘ç¹æŸ¥è¯¢çš„åˆ†æç»“æœï¼Œå¯å°†ç»“æ•°æ®å­˜å‚¨ä¸ºå•ç‹¬çš„è¡¨æˆ–ç¼“å­˜ï¼Œå‡å°‘é‡å¤è®¡ç®—ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚
5. æ•°æ®æ¥å£è®¾è®¡ï¼šä¸ºå‰ç«¯æä¾›ç»Ÿä¸€æ¥å£ï¼Œä»è€Œæ”¯æŒæŸ¥è¯¢å’Œå±•ç¤ºã€‚éœ€è¦è€ƒè™‘åˆ°æ•°æ®é‡è¾ƒå¤§å¯¼è‡´å‰ç«¯æ¸²æŸ“å¡é¡¿çš„æƒ…å†µï¼Œå¯ä»¥æŒ‰éœ€ç²¾ç®€è¿”å›çš„å­—ç¬¦ä¸²ã€åˆ†é¡µæŸ¥è¯¢ç­‰ã€‚
6. æ•°æ®å¯è§†åŒ–ï¼šé€šè¿‡å›¾è¡¨ç›´è§‚å±•ç¤ºåˆ†æç»“æœï¼Œå‰ç«¯å¯ä»¥ä½¿ç”¨ [Apache ECharts](https://echarts.apache.org/) ç­‰å¯è§†åŒ–åº“æ¸²æŸ“ã€‚å½“ç„¶ä¹Ÿå¯ä»¥è®©åç«¯ç”Ÿæˆå›¾è¡¨å›¾ç‰‡å¹¶è¿”å›ï¼Œä½†è¿™ç§å®ç°æ–¹æ³•çš„çµæ´»åº¦æœ‰é™ã€‚

åç»­è¿˜å¯ä»¥æ ¹æ®ç”¨æˆ·çš„åé¦ˆæŒç»­ä¼˜åŒ–åˆ†æé€»è¾‘ã€å¢åŠ æŒ‡æ ‡æˆ–æ”¹è¿›æ€§èƒ½ã€‚

### 2ã€æ™ºäº‘å›¾å®ç°æ–¹æ¡ˆ

é€šè¿‡éœ€æ±‚åˆ†æï¼Œæˆ‘ä»¬å‘ç°ï¼Œç®¡ç†å‘˜å¯¹å…¬å…±å›¾åº“åŠå…¨ç©ºé—´çš„åˆ†æéœ€æ±‚ï¼Œä¸ç”¨æˆ·å¯¹è‡ªå·±ç©ºé—´çš„åˆ†æéœ€æ±‚åœ¨æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ï¼Œ**å”¯ä¸€çš„åŒºåˆ«åœ¨äºå›¾ç‰‡èŒƒå›´çš„é€‰æ‹©**ã€‚

ä¸‹é¢ä»¥ â€œç©ºé—´å›¾ç‰‡åˆ†ç±»åˆ†æâ€ ä¸ºä¾‹ã€‚

1ï¼‰ç”¨æˆ·åˆ†æè‡ªå·±çš„ç©ºé—´ï¼ŒSQL ç¤ºä¾‹ï¼š

```sql
SELECT category, SUM(picSize) AS totalSize
FROM picture 
WHERE spaceId = xxx
GROUP BY category;
```

2ï¼‰ç®¡ç†å‘˜åˆ†æå…¬å…±å›¾åº“ï¼ŒSQL ç¤ºä¾‹ï¼š

```sql
SELECT category, SUM(picSize) AS totalSize
FROM picture 
WHERE spaceId IS NULL
GROUP BY category;
```

3ï¼‰ç®¡ç†å‘˜åˆ†æå…¨éƒ¨ç©ºé—´ï¼ŒSQL ç¤ºä¾‹ï¼š

```sql
SELECT category, SUM(picSize) AS totalSize
FROM picture 
GROUP BY category;
```

ä¼šå‘ç°ï¼Œé™¤äº† where æŸ¥è¯¢æ¡ä»¶ä¸åŒä¹‹å¤–ï¼Œå…¶ä»–çš„è®¡ç®—æ–¹å¼éƒ½æ˜¯ä¸€è‡´çš„ã€‚

æ‰€ä»¥å¯ä»¥è®¾è®¡ç»Ÿä¸€çš„æ¥å£ï¼Œé€šè¿‡ä¼ é€’ä¸åŒçš„è¯·æ±‚å‚æ•°ï¼ŒåŒæ—¶æ»¡è¶³ä¸Šè¿°éœ€æ±‚ã€‚å‚æ•°å«ä¹‰å’Œä¼˜å…ˆçº§å¦‚ä¸‹ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ï¼š

1. queryAll å­—æ®µï¼šä¸º true æ—¶è¡¨ç¤ºæŸ¥è¯¢å…¨ç©ºé—´ï¼Œä»…ç®¡ç†å‘˜å¯ä½¿ç”¨ã€‚
2. queryPublic å­—æ®µï¼šä¸º true æ—¶è¡¨ç¤ºæŸ¥è¯¢å…¬å…±å›¾åº“ï¼Œä»…ç®¡ç†å‘˜å¯ä½¿ç”¨ã€‚
3. spaceId å­—æ®µï¼šä»…åœ¨ queryAll å’Œ queryPublic å‡ä¸º false æ—¶ç”Ÿæ•ˆï¼Œè¡¨ç¤ºå¯¹ç‰¹å®šç©ºé—´è¿›è¡Œåˆ†æï¼Œä»…ç©ºé—´åˆ›å»ºè€…å’Œç®¡ç†å‘˜å¯ä½¿ç”¨ã€‚

å¯¹åº”çš„åç«¯ä¼ªä»£ç å¦‚ä¸‹ï¼Œå¯ä»¥å°†è¿™æ®µé€»è¾‘å°è£…ä¸ºå•ç‹¬çš„æ–¹æ³•ï¼š

```java
// å…ˆæƒé™æ ¡éªŒ
// å°è£…æŸ¥è¯¢æ¡ä»¶
QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
if (queryAll) {
    // ç®¡ç†å‘˜æŸ¥è¯¢å…¨ç©ºé—´ï¼Œä¸æ·»åŠ è¿‡æ»¤æ¡ä»¶
} else if (queryPublic) {
    // ç®¡ç†å‘˜æŸ¥è¯¢å…¬å…±å›¾åº“
    queryWrapper.isNull("spaceId");
} else if (spaceId != null) {
    // ç”¨æˆ·æˆ–ç®¡ç†å‘˜æŸ¥è¯¢ç‰¹å®šç©ºé—´
    queryWrapper.eq("spaceId", spaceId);
} else {
    throw new BusinessException(ErrorCode.PARAMS_ERROR, "æœªæŒ‡å®šæŸ¥è¯¢èŒƒå›´");
}
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°±ä¸ç”¨å¤šé’ˆå¯¹ä¸åŒçš„æŸ¥è¯¢èŒƒå›´ç¼–å†™ä¸€å¥—æ¥å£äº†ï¼Œå¯ä»¥å¤§å¹…å‡å°‘é‡å¤ä»£ç ã€‚

## ä¸‰ã€åç«¯å¼€å‘

å¯¹åº”çš„åç«¯ä¼ªä»£ç å¦‚ä¸‹ï¼Œå¯ä»¥å°†è¿™æ®µé€»è¾‘å°è£…ä¸ºå•ç‹¬çš„æ–¹æ³•ï¼š

```java
// å…ˆæƒé™æ ¡éªŒ
// å°è£…æŸ¥è¯¢æ¡ä»¶
QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
if (queryAll) {
    // ç®¡ç†å‘˜æŸ¥è¯¢å…¨ç©ºé—´ï¼Œä¸æ·»åŠ è¿‡æ»¤æ¡ä»¶
} else if (queryPublic) {
    // ç®¡ç†å‘˜æŸ¥è¯¢å…¬å…±å›¾åº“
    queryWrapper.isNull("spaceId");
} else if (spaceId != null) {
    // ç”¨æˆ·æˆ–ç®¡ç†å‘˜æŸ¥è¯¢ç‰¹å®šç©ºé—´
    queryWrapper.eq("spaceId", spaceId);
} else {
    throw new BusinessException(ErrorCode.PARAMS_ERROR, "æœªæŒ‡å®šæŸ¥è¯¢èŒƒå›´");
}
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°±ä¸ç”¨å¤šé’ˆå¯¹ä¸åŒçš„æŸ¥è¯¢èŒƒå›´ç¼–å†™ä¸€å¥—æ¥å£äº†ï¼Œå¯ä»¥å¤§å¹…å‡å°‘é‡å¤ä»£ç ã€‚

åˆ†æéœ€æ±‚ç›¸å…³çš„ DTO å’Œ VO æ•°æ®æ¨¡å‹æ”¾åˆ° `analyze` åŒ…ä¸‹

![](https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503221009305.png)

### 1ã€é€šç”¨åˆ†æè¯·æ±‚

1ï¼‰ç”±äºæˆ‘ä»¬çš„å¾ˆå¤šåˆ†æéœ€æ±‚éƒ½éœ€è¦ä¼ é€’ç©ºé—´æŸ¥è¯¢èŒƒå›´ï¼Œå¯ä»¥å…ˆå†™ä¸€ä¸ªå…¬å…±çš„å›¾ç‰‡åˆ†æè¯·æ±‚å°è£…ç±»ï¼š

```java
@Data
public class SpaceAnalyzeRequest implements Serializable {

    /**
     * ç©ºé—´ ID
     */
    private Long spaceId;

    /**
     * æ˜¯å¦æŸ¥è¯¢å…¬å…±å›¾åº“
     */
    private boolean queryPublic;

    /**
     * å…¨ç©ºé—´åˆ†æ
     */
    private boolean queryAll;

    private static final long serialVersionUID = 1L;
}
```

ç„¶åå„ä¸ªå…·ä½“çš„åˆ†æè¯·æ±‚å°è£…ç±»å°±èƒ½ç›´æ¥ç»§æ‰¿äº†ï¼Œè¿™æ ·ä¹Ÿä¾¿äºåç»­ç¼–å†™é€šç”¨çš„åˆ†æè¯·æ±‚å¤„ç†æ–¹æ³•ã€‚

2ï¼‰æˆ‘ä»¬å¯ä»¥æ–°å»º SpaceAnalyzeService å’Œå¯¹åº”å®ç°ç±»ï¼Œå¼€å‘æ ¡éªŒç©ºé—´åˆ†ææƒé™ã€æ ¹æ®åˆ†æèŒƒå›´å¡«å……æŸ¥è¯¢å¯¹è±¡è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œåç»­çš„éœ€æ±‚ä¹Ÿéƒ½ä¼šç”¨åˆ°ã€‚

æ ¡éªŒç©ºé—´åˆ†ææƒé™ï¼š

```java
private void checkSpaceAnalyzeAuth(SpaceAnalyzeRequest spaceAnalyzeRequest, User loginUser) {
    // æ£€æŸ¥æƒé™
    if (spaceAnalyzeRequest.isQueryAll() || spaceAnalyzeRequest.isQueryPublic()) {
        // å…¨ç©ºé—´åˆ†ææˆ–è€…å…¬å…±å›¾åº“æƒé™æ ¡éªŒï¼šä»…ç®¡ç†å‘˜å¯è®¿é—®
        ThrowUtils.throwIf(!userService.isAdmin(loginUser), ErrorCode.NO_AUTH_ERROR, "æ— æƒè®¿é—®å…¬å…±å›¾åº“");
    } else {
        // ç§æœ‰ç©ºé—´æƒé™æ ¡éªŒ
        Long spaceId = spaceAnalyzeRequest.getSpaceId();
        ThrowUtils.throwIf(spaceId == null || spaceId <= 0, ErrorCode.PARAMS_ERROR);
        Space space = spaceService.getById(spaceId);
        ThrowUtils.throwIf(space == null, ErrorCode.NOT_FOUND_ERROR, "ç©ºé—´ä¸å­˜åœ¨");
        spaceService.checkSpaceAuth(loginUser, space);
    }
}
```

æ ¹æ®åˆ†æèŒƒå›´å¡«å……æŸ¥è¯¢å¯¹è±¡ï¼š

```java
private static void fillAnalyzeQueryWrapper(SpaceAnalyzeRequest spaceAnalyzeRequest, QueryWrapper<Picture> queryWrapper) {
    if (spaceAnalyzeRequest.isQueryAll()) {
        return;
    }
    if (spaceAnalyzeRequest.isQueryPublic()) {
        queryWrapper.isNull("spaceId");
        return;
    }
    Long spaceId = spaceAnalyzeRequest.getSpaceId();
    if (spaceId != null) {
        queryWrapper.eq("spaceId", spaceId);
        return;
    }
    throw new BusinessException(ErrorCode.PARAMS_ERROR, "æœªæŒ‡å®šæŸ¥è¯¢èŒƒå›´");
}
```

### 2ã€éœ€æ±‚å¼€å‘

#### 1ã€ç©ºé—´èµ„æºä½¿ç”¨åˆ†æ

1ï¼‰å¼€å‘è¯·æ±‚å°è£…ç±»ï¼Œç”¨äºæ¥æ”¶å‰ç«¯è¯·æ±‚çš„æ•°æ®ã€‚æ­¤å¤„ç›´æ¥ç»§æ‰¿é€šç”¨çš„å›¾ç‰‡åˆ†æè¯·æ±‚å°è£…ç±»å³å¯ï¼Œä¸éœ€è¦ä¼ é€’å…¶ä»–å­—æ®µï¼š

```java
@EqualsAndHashCode(callSuper = true)
@Data
public class SpaceUsageAnalyzeRequest extends SpaceAnalyzeRequest {

}
```

2ï¼‰å¼€å‘å“åº”è§†å›¾ç±»ï¼Œç”¨äºå°†åˆ†æç»“æœè¿”å›ç»™å‰ç«¯ï¼š

```java
@Data
public class SpaceUsageAnalyzeResponse implements Serializable {

    /**
     * å·²ä½¿ç”¨å¤§å°
     */
    private Long usedSize;

    /**
     * æ€»å¤§å°
     */
    private Long maxSize;

    /**
     * ç©ºé—´ä½¿ç”¨æ¯”ä¾‹
     */
    private Double sizeUsageRatio;

    /**
     * å½“å‰å›¾ç‰‡æ•°é‡
     */
    private Long usedCount;

    /**
     * æœ€å¤§å›¾ç‰‡æ•°é‡
     */
    private Long maxCount;

    /**
     * å›¾ç‰‡æ•°é‡å æ¯”
     */
    private Double countUsageRatio;

    private static final long serialVersionUID = 1L;
}
```

3ï¼‰å¼€å‘ SpaceAnalyzeService ä¸šåŠ¡é€»è¾‘å±‚

æ³¨æ„ï¼Œå¦‚æœæ˜¯åˆ†æå…¨ç©ºé—´æˆ–å…¬å…±å›¾åº“çš„ä½¿ç”¨æƒ…å†µï¼Œéœ€è¦ç¼–å†™ â€œ==ä»…ç®¡ç†å‘˜å¯è®¿é—®==â€ çš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå¹¶ä¸”æ›´æ”¹æŸ¥è¯¢å›¾ç‰‡è¡¨çš„èŒƒå›´ï¼›å¦‚æœåªæ˜¯åˆ†æå•ä¸ªç©ºé—´çš„ä½¿ç”¨æƒ…å†µï¼Œç›´æ¥ä»ç©ºé—´è¡¨æŸ¥è¯¢å‡ºå•ä¸ªç©ºé—´çš„æ•°æ®å³å¯ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```java
/**
 * è·å–ç©ºé—´ä½¿ç”¨åˆ†ææ•°æ®
 *
 * @param spaceUsageAnalyzeRequest SpaceUsageAnalyzeRequest è¯·æ±‚å‚æ•°
 * @param loginUser                å½“å‰ç™»å½•ç”¨æˆ·
 * @return SpaceUsageAnalyzeResponse åˆ†æç»“æœ
 */
@Override
public SpaceUsageAnalyzeResponse getSpaceUsageAnalyze(SpaceUsageAnalyzeRequest spaceUsageAnalyzeRequest, User loginUser) {
    ThrowUtils.throwIf(spaceUsageAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    if (spaceUsageAnalyzeRequest.isQueryAll() || spaceUsageAnalyzeRequest.isQueryPublic()) {
        // æŸ¥è¯¢å…¨éƒ¨æˆ–å…¬å…±å›¾åº“é€»è¾‘
        // ä»…ç®¡ç†å‘˜å¯ä»¥è®¿é—®
        boolean isAdmin = userService.isAdmin(loginUser);
        ThrowUtils.throwIf(!isAdmin, ErrorCode.NO_AUTH_ERROR, "æ— æƒè®¿é—®ç©ºé—´"); //å¦‚æœæ²¡æŠ›å‡ºï¼Œè¯´æ˜æ˜¯ç®¡ç†å‘˜ï¼Œç»Ÿè®¡ä¸‹é¢ä¿¡æ¯
        // ç»Ÿè®¡å…¬å…±å›¾åº“çš„èµ„æºä½¿ç”¨
        QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
        queryWrapper.select("picSize");
        if (!spaceUsageAnalyzeRequest.isQueryAll()) { //ä¸æ˜¯æŸ¥è¯¢æ‰€æœ‰ï¼Œé‚£å°±æ˜¯æŸ¥è¯¢å…¬å…±å›¾åº“
            queryWrapper.isNull("spaceId"); //ç©ºé—´idä¸ºç©º
        }
        List<Object> pictureObjList = pictureService.getBaseMapper().selectObjs(queryWrapper);
        long usedSize = pictureObjList.stream().mapToLong(result -> result instanceof Long ? (Long) result : 0).sum();
        long usedCount = pictureObjList.size();
        // å°è£…è¿”å›ç»“æœ
        SpaceUsageAnalyzeResponse spaceUsageAnalyzeResponse = new SpaceUsageAnalyzeResponse();
        spaceUsageAnalyzeResponse.setUsedSize(usedSize);
        spaceUsageAnalyzeResponse.setUsedCount(usedCount);
        // å…¬å…±å›¾åº“æ— ä¸Šé™ã€æ— æ¯”ä¾‹
        spaceUsageAnalyzeResponse.setMaxSize(null);
        spaceUsageAnalyzeResponse.setSizeUsageRatio(null);
        spaceUsageAnalyzeResponse.setMaxCount(null);
        spaceUsageAnalyzeResponse.setCountUsageRatio(null);
        return spaceUsageAnalyzeResponse;
    } else {
        // æŸ¥è¯¢æŒ‡å®šç©ºé—´
        Long spaceId = spaceUsageAnalyzeRequest.getSpaceId();
        ThrowUtils.throwIf(spaceId == null || spaceId <= 0, ErrorCode.PARAMS_ERROR);
        // è·å–ç©ºé—´ä¿¡æ¯
        Space space = spaceService.getById(spaceId);
        ThrowUtils.throwIf(space == null, ErrorCode.NOT_FOUND_ERROR, "ç©ºé—´ä¸å­˜åœ¨");

        // æƒé™æ ¡éªŒï¼šä»…ç©ºé—´æ‰€æœ‰è€…æˆ–ç®¡ç†å‘˜å¯è®¿é—®
        spaceService.checkSpaceAuth(loginUser, space);

        // æ„é€ è¿”å›ç»“æœ
        SpaceUsageAnalyzeResponse response = new SpaceUsageAnalyzeResponse();
        response.setUsedSize(space.getTotalSize());
        response.setMaxSize(space.getMaxSize());
        // åç«¯ç›´æ¥ç®—å¥½ç™¾åˆ†æ¯”ï¼Œè¿™æ ·å‰ç«¯å¯ä»¥ç›´æ¥å±•ç¤º
        double sizeUsageRatio = NumberUtil.round(space.getTotalSize() * 100.0 / space.getMaxSize(), 2).doubleValue();
        response.setSizeUsageRatio(sizeUsageRatio);
        response.setUsedCount(space.getTotalCount());
        response.setMaxCount(space.getMaxCount());
        double countUsageRatio = NumberUtil.round(space.getTotalCount() * 100.0 / space.getMaxCount(), 2).doubleValue();
        response.setCountUsageRatio(countUsageRatio);
        return response;
    }
}
```

<img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503221036090.png" style="zoom:50%;" />

:::tip

è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹ï¼špictureService.getBaseMapper().selectObjs(queryWrapper);

ä¸ºä»€ä¹ˆä¸ç”¨ï¼Œ`pictureService.list`ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦picSizeå­—æ®µï¼Œlistä¼šæŠŠæ‰€æœ‰ä¿¡æ¯ï¼ˆå°è£…ä¸º Picture å¯¹è±¡ï¼‰éƒ½è¿”å›å‡ºæ¥ã€‚

:::

```java
QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
queryWrapper.select("picSize");
if (!spaceUsageAnalyzeRequest.isQueryAll()) {
    queryWrapper.isNull("spaceId");
}
List<Object> pictureObjList = pictureService.getBaseMapper().selectObjs(queryWrapper);
long usedSize = pictureObjList.stream().mapToLong(result -> result instanceof Long ? (Long) result : 0).sum();
```

å¯ä»¥åœ¨ SpaceService ä¸­å°è£…ç©ºé—´æƒé™æ ¡éªŒæ–¹æ³•ï¼Œå…¶ä»–çš„åˆ†æéœ€æ±‚ä¹Ÿä¼šç”¨åˆ°ï¼š

```java
/**
 * ç©ºé—´æƒé™æ ¡éªŒ
 *
 * @param loginUser
 * @param space
 */
@Override
public void checkSpaceAuth(User loginUser, Space space) {
    // ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯è®¿é—®
    if (!space.getUserId().equals(loginUser.getId()) && !userService.isAdmin(loginUser)) {
        throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
    }
}
```

ç„¶åå¯ä»¥å°† SpaceController ä¸­ç¼–è¾‘å’Œåˆ é™¤æ“ä½œçš„æƒé™æ ¡éªŒä»£ç æ›¿æ¢ä¸º checkSpaceAuth æ–¹æ³•ï¼Œç»Ÿä¸€ç©ºé—´æ ¡éªŒé€»è¾‘ã€‚

4ï¼‰å¼€å‘ SpaceAnalyzeController æ¥å£ï¼š

```java
@RestController
@RequestMapping("/space/analyze")
public class SpaceAnalyzeController {

    @Resource
    private SpaceAnalyzeService spaceAnalyzeService;

    @Resource
    private UserService userService;

    /**
     * è·å–ç©ºé—´ä½¿ç”¨çŠ¶æ€
     */
    @PostMapping("/usage")
    public BaseResponse<SpaceUsageAnalyzeResponse> getSpaceUsageAnalyze(
            @RequestBody SpaceUsageAnalyzeRequest spaceUsageAnalyzeRequest,
            HttpServletRequest request
    ) {
        ThrowUtils.throwIf(spaceUsageAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
        User loginUser = userService.getLoginUser(request);
        SpaceUsageAnalyzeResponse spaceUsageAnalyze = spaceAnalyzeService.getSpaceUsageAnalyze(spaceUsageAnalyzeRequest, loginUser);
        return ResultUtils.success(spaceUsageAnalyze);
    }
}
```

#### 2ã€ç©ºé—´å›¾ç‰‡åˆ†ç±»åˆ†æ

1ï¼‰å¼€å‘è¯·æ±‚å°è£…ç±»ã€‚åˆ†ç±»åˆ†æåªéœ€è¦ä¼ é€’ç©ºé—´èŒƒå›´ç›¸å…³å‚æ•°ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç»§æ‰¿å…¬å…±çš„ `SpaceAnalyzeRequest`ï¼š

```java
@EqualsAndHashCode(callSuper = true)
@Data
public class SpaceCategoryAnalyzeRequest extends SpaceAnalyzeRequest {

}
```

2ï¼‰å¼€å‘å“åº”è§†å›¾ç±»ã€‚åˆ†ç±»åˆ†æçš„ç»“æœéœ€è¦è¿”å›å›¾ç‰‡åˆ†ç±»ã€åˆ†ç±»å›¾ç‰‡æ•°é‡å’Œåˆ†ç±»å›¾ç‰‡æ€»å¤§å°ï¼š

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class SpaceCategoryAnalyzeResponse implements Serializable {

    /**
     * å›¾ç‰‡åˆ†ç±»
     */
    private String category;

    /**
     * å›¾ç‰‡æ•°é‡
     */
    private Long count;

    /**
     * åˆ†ç±»å›¾ç‰‡æ€»å¤§å°
     */
    private Long totalSize;

    private static final long serialVersionUID = 1L;
}
```

3ï¼‰å¼€å‘ Service æœåŠ¡ã€‚æŒ‰ç…§åˆ†ç±»åˆ†ç»„æŸ¥è¯¢å›¾ç‰‡è¡¨çš„æ•°æ®ï¼Œæ³¨æ„æŸ¥è¯¢æ•°æ®åº“æ—¶åªè·å–éœ€è¦çš„å­—æ®µå³å¯ï¼š

```java
@Override
public List<SpaceCategoryAnalyzeResponse> getSpaceCategoryAnalyze(SpaceCategoryAnalyzeRequest spaceCategoryAnalyzeRequest, User loginUser) {
    ThrowUtils.throwIf(spaceCategoryAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);

    // æ£€æŸ¥æƒé™
    checkSpaceAnalyzeAuth(spaceCategoryAnalyzeRequest, loginUser);

    // æ„é€ æŸ¥è¯¢æ¡ä»¶
    QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
    // æ ¹æ®åˆ†æèŒƒå›´è¡¥å……æŸ¥è¯¢æ¡ä»¶
    fillAnalyzeQueryWrapper(spaceCategoryAnalyzeRequest, queryWrapper);

    // ä½¿ç”¨ MyBatis-Plus åˆ†ç»„æŸ¥è¯¢
    queryWrapper.select("category AS category",
                    "COUNT(*) AS count",
                    "SUM(picSize) AS totalSize")
            .groupBy("category");

    // æŸ¥è¯¢å¹¶è½¬æ¢ç»“æœ
    return pictureService.getBaseMapper().selectMaps(queryWrapper)
            .stream()
            .map(result -> {
                String category = result.get("category") != null ? result.get("category").toString() : "æœªåˆ†ç±»";
                Long count = ((Number) result.get("count")).longValue();
                Long totalSize = ((Number) result.get("totalSize")).longValue();
                return new SpaceCategoryAnalyzeResponse(category, count, totalSize);
            })
            .collect(Collectors.toList());
}
```

ğŸ’¡ å»ºè®®åœ¨ç¼–å†™å…·ä½“çš„ä»£ç å‰ï¼Œå…ˆç¼–å†™ç¤ºä¾‹ SQL è¯­å¥ï¼Œå¹¶é€šè¿‡æ•°æ®åº“æŸ¥è¯¢å®¢æˆ·ç«¯æ¥éªŒè¯ã€‚

4ï¼‰å¼€å‘æ¥å£ï¼š

```java
@PostMapping("/category")
public BaseResponse<List<SpaceCategoryAnalyzeResponse>> getSpaceCategoryAnalyze(@RequestBody SpaceCategoryAnalyzeRequest spaceCategoryAnalyzeRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(spaceCategoryAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    List<SpaceCategoryAnalyzeResponse> resultList = spaceAnalyzeService.getSpaceCategoryAnalyze(spaceCategoryAnalyzeRequest, loginUser);
    return ResultUtils.success(resultList);
}
```

#### 3ã€ç©ºé—´å›¾ç‰‡æ ‡ç­¾åˆ†æ

1ï¼‰å¼€å‘è¯·æ±‚å°è£…ç±»ï¼Œæ ‡ç­¾åˆ†æåŒæ ·éœ€è¦ç»§æ‰¿ `SpaceAnalyzeRequest`ï¼š

```java
@EqualsAndHashCode(callSuper = true)
@Data
public class SpaceTagAnalyzeRequest extends SpaceAnalyzeRequest {

}
```

2ï¼‰å¼€å‘å“åº”è§†å›¾ç±»ã€‚æ ‡ç­¾åˆ†æçš„ç»“æœéœ€è¦è¿”å›æ ‡ç­¾åç§°å’Œå…³è”çš„å›¾ç‰‡æ•°é‡ï¼š

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class SpaceTagAnalyzeResponse implements Serializable {

    /**
     * æ ‡ç­¾åç§°
     */
    private String tag;

    /**
     * ä½¿ç”¨æ¬¡æ•°
     */
    private Long count;

    private static final long serialVersionUID = 1L;
}
```

3ï¼‰å¼€å‘ Service æœåŠ¡ã€‚ä»æ•°æ®åº“è·å–æ ‡ç­¾æ•°æ®ï¼Œç»Ÿè®¡æ¯ä¸ªæ ‡ç­¾çš„å›¾ç‰‡æ•°é‡ï¼Œå¹¶æŒ‰ä½¿ç”¨æ¬¡æ•°é™åºæ’åºï¼š

```java
@Override
public List<SpaceTagAnalyzeResponse> getSpaceTagAnalyze(SpaceTagAnalyzeRequest spaceTagAnalyzeRequest, User loginUser) {
    ThrowUtils.throwIf(spaceTagAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);

    // æ£€æŸ¥æƒé™
    checkSpaceAnalyzeAuth(spaceTagAnalyzeRequest, loginUser);

    // æ„é€ æŸ¥è¯¢æ¡ä»¶
    QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
    fillAnalyzeQueryWrapper(spaceTagAnalyzeRequest, queryWrapper);

    // æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ ‡ç­¾
    queryWrapper.select("tags");
    List<String> tagsJsonList = pictureService.getBaseMapper().selectObjs(queryWrapper)
            .stream()
            .filter(ObjUtil::isNotNull)
            .map(Object::toString)
            .collect(Collectors.toList());

    // åˆå¹¶æ‰€æœ‰æ ‡ç­¾å¹¶ç»Ÿè®¡ä½¿ç”¨æ¬¡æ•°
    Map<String, Long> tagCountMap = tagsJsonList.stream()
            .flatMap(tagsJson -> JSONUtil.toList(tagsJson, String.class).stream())
            .collect(Collectors.groupingBy(tag -> tag, Collectors.counting()));

    // è½¬æ¢ä¸ºå“åº”å¯¹è±¡ï¼ŒæŒ‰ä½¿ç”¨æ¬¡æ•°é™åºæ’åº
    return tagCountMap.entrySet().stream()
            .sorted((e1, e2) -> Long.compare(e2.getValue(), e1.getValue())) // é™åºæ’åˆ—
            .map(entry -> new SpaceTagAnalyzeResponse(entry.getKey(), entry.getValue()))
            .collect(Collectors.toList());
}
```

4ï¼‰å¼€å‘æ¥å£ï¼š

```java
@PostMapping("/tag")
public BaseResponse<List<SpaceTagAnalyzeResponse>> getSpaceTagAnalyze(@RequestBody SpaceTagAnalyzeRequest spaceTagAnalyzeRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(spaceTagAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    List<SpaceTagAnalyzeResponse> resultList = spaceAnalyzeService.getSpaceTagAnalyze(spaceTagAnalyzeRequest, loginUser);
    return ResultUtils.success(resultList);
}
```

#### 4ã€ç©ºé—´å›¾ç‰‡å¤§å°åˆ†æ

1ï¼‰å¼€å‘è¯·æ±‚å°è£…ç±»ã€‚å›¾ç‰‡å¤§å°åˆ†æä¹Ÿç»§æ‰¿ `SpaceAnalyzeRequest`ï¼š

```java
@EqualsAndHashCode(callSuper = true)
@Data
public class SpaceSizeAnalyzeRequest extends SpaceAnalyzeRequest {

}
```

2ï¼‰å¼€å‘å“åº”è§†å›¾ç±»ã€‚å¤§å°åˆ†æç»“æœéœ€è¦è¿”å›å›¾ç‰‡å¤§å°èŒƒå›´å’Œå¯¹åº”çš„å›¾ç‰‡æ•°é‡ï¼š

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class SpaceSizeAnalyzeResponse implements Serializable {

    /**
     * å›¾ç‰‡å¤§å°èŒƒå›´
     */
    private String sizeRange;

    /**
     * å›¾ç‰‡æ•°é‡
     */
    private Long count;

    private static final long serialVersionUID = 1L;
}
```

3ï¼‰å¼€å‘ Service æœåŠ¡ï¼Œåˆ†æ®µç»Ÿè®¡å›¾ç‰‡å¤§å°ï¼š

```java
@Override
public List<SpaceSizeAnalyzeResponse> getSpaceSizeAnalyze(SpaceSizeAnalyzeRequest spaceSizeAnalyzeRequest, User loginUser) {
    ThrowUtils.throwIf(spaceSizeAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);

    // æ£€æŸ¥æƒé™
    checkSpaceAnalyzeAuth(spaceSizeAnalyzeRequest, loginUser);

    // æ„é€ æŸ¥è¯¢æ¡ä»¶
    QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
    fillAnalyzeQueryWrapper(spaceSizeAnalyzeRequest, queryWrapper);

    // æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å›¾ç‰‡å¤§å°
    queryWrapper.select("picSize");
    List<Long> picSizes = pictureService.getBaseMapper().selectObjs(queryWrapper)
            .stream()
            .map(size -> ((Number) size).longValue())
            .collect(Collectors.toList());

    // å®šä¹‰åˆ†æ®µèŒƒå›´ï¼Œæ³¨æ„ä½¿ç”¨æœ‰åº Map
    Map<String, Long> sizeRanges = new LinkedHashMap<>();
    sizeRanges.put("<100KB", picSizes.stream().filter(size -> size < 100 * 1024).count());
    sizeRanges.put("100KB-500KB", picSizes.stream().filter(size -> size >= 100 * 1024 && size < 500 * 1024).count());
    sizeRanges.put("500KB-1MB", picSizes.stream().filter(size -> size >= 500 * 1024 && size < 1 * 1024 * 1024).count());
    sizeRanges.put(">1MB", picSizes.stream().filter(size -> size >= 1 * 1024 * 1024).count());

    // è½¬æ¢ä¸ºå“åº”å¯¹è±¡
    return sizeRanges.entrySet().stream() //å–å‡ºè¿™ä¸ªmapçš„æ¯ä¸ªentry
            .map(entry -> new SpaceSizeAnalyzeResponse(entry.getKey(), entry.getValue()))
            .collect(Collectors.toList());
}
```

ä¸Šè¿°ä»£ç å…¶å®è¿˜å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œåªéœ€è¦éå†ä¸€æ¬¡ picSizes åˆ—è¡¨å°±å¯ä»¥æŒ‰å¤§å°åˆ†åˆ«ç»Ÿè®¡äº†ã€‚

4ï¼‰å¼€å‘æ¥å£ï¼š

```java
@PostMapping("/size")
public BaseResponse<List<SpaceSizeAnalyzeResponse>> getSpaceSizeAnalyze(@RequestBody SpaceSizeAnalyzeRequest spaceSizeAnalyzeRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(spaceSizeAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    List<SpaceSizeAnalyzeResponse> resultList = spaceAnalyzeService.getSpaceSizeAnalyze(spaceSizeAnalyzeRequest, loginUser);
    return ResultUtils.success(resultList);
}
```

#### 5ã€ç”¨æˆ·ä¸Šä¼ è¡Œä¸ºåˆ†æ

1ï¼‰å¼€å‘è¯·æ±‚å°è£…ç±»ã€‚ç”¨æˆ·ä¸Šä¼ è¡Œä¸ºåˆ†æéœ€è¦å¢åŠ æ—¶é—´ç»´åº¦ï¼ˆæ—¥ã€å‘¨ã€æœˆï¼‰å’Œç”¨æˆ· ID å‚æ•°ï¼Œæ”¯æŒåªåˆ†ææŸä¸ªç”¨æˆ·ä¸Šä¼ å›¾ç‰‡çš„æƒ…å†µã€‚

```java
@EqualsAndHashCode(callSuper = true)
@Data
public class SpaceUserAnalyzeRequest extends SpaceAnalyzeRequest {

    /**
     * ç”¨æˆ· ID
     */
    private Long userId;

    /**
     * æ—¶é—´ç»´åº¦ï¼šday / week / month
     */
    private String timeDimension;
}
```

2ï¼‰å¼€å‘å“åº”è§†å›¾ç±»ã€‚ç”¨æˆ·è¡Œä¸ºåˆ†æç»“æœéœ€è¦è¿”å›æ—¶é—´åŒºé—´å’Œå¯¹åº”çš„å›¾ç‰‡æ•°é‡ï¼š

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class SpaceUserAnalyzeResponse implements Serializable {

    /**
     * æ—¶é—´åŒºé—´
     */
    private String period;

    /**
     * ä¸Šä¼ æ•°é‡
     */
    private Long count;

    private static final long serialVersionUID = 1L;
}
```

3ï¼‰å¼€å‘ Service æœåŠ¡ï¼ŒåŸºäºå›¾ç‰‡çš„åˆ›å»ºæ—¶é—´ç»´åº¦ç»Ÿè®¡ç”¨æˆ·çš„ä¸Šä¼ è¡Œä¸ºï¼Œå¹¶æŒ‰ç…§æ—¶é—´å‡åºæ’åºï¼š

```java
@Override
public List<SpaceUserAnalyzeResponse> getSpaceUserAnalyze(SpaceUserAnalyzeRequest spaceUserAnalyzeRequest, User loginUser) {
    ThrowUtils.throwIf(spaceUserAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    // æ£€æŸ¥æƒé™
    checkSpaceAnalyzeAuth(spaceUserAnalyzeRequest, loginUser);

    // æ„é€ æŸ¥è¯¢æ¡ä»¶
    QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
    Long userId = spaceUserAnalyzeRequest.getUserId();
    queryWrapper.eq(ObjUtil.isNotNull(userId), "userId", userId);
    fillAnalyzeQueryWrapper(spaceUserAnalyzeRequest, queryWrapper);

    // åˆ†æç»´åº¦ï¼šæ¯æ—¥ã€æ¯å‘¨ã€æ¯æœˆ
    String timeDimension = spaceUserAnalyzeRequest.getTimeDimension();
    switch (timeDimension) {
        case "day":
            queryWrapper.select("DATE_FORMAT(createTime, '%Y-%m-%d') AS period", "COUNT(*) AS count");
            break;
        case "week":
            queryWrapper.select("YEARWEEK(createTime) AS period", "COUNT(*) AS count");
            break;
        case "month":
            queryWrapper.select("DATE_FORMAT(createTime, '%Y-%m') AS period", "COUNT(*) AS count");
            break;
        default:
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "ä¸æ”¯æŒçš„æ—¶é—´ç»´åº¦");
    }

    // åˆ†ç»„å’Œæ’åº
    queryWrapper.groupBy("period").orderByAsc("period");

    // æŸ¥è¯¢ç»“æœå¹¶è½¬æ¢
    List<Map<String, Object>> queryResult = pictureService.getBaseMapper().selectMaps(queryWrapper);
    return queryResult.stream()
            .map(result -> {
                String period = result.get("period").toString();
                Long count = ((Number) result.get("count")).longValue();
                return new SpaceUserAnalyzeResponse(period, count);
            })
            .collect(Collectors.toList());
}
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ MySQL çš„æ—¥æœŸæ—¶é—´å‡½æ•°å¯¹å›¾ç‰‡çš„åˆ›å»ºæ—¶é—´è¿›è¡Œäº†æ ¼å¼åŒ–ï¼Œä½¿å¾—åŒä¸€å¤©ï¼ˆå‘¨ / æœˆï¼‰çš„å€¼ç›¸åŒï¼Œå°±èƒ½å¤Ÿç»Ÿä¸€æŒ‰ç…§ä¸€ä¸ªå­—æ®µï¼ˆperiodï¼‰è¿›è¡Œåˆ†ç»„å’Œæ’åºäº†ã€‚

4ï¼‰å¼€å‘æ¥å£ï¼š

```java
@PostMapping("/user")
public BaseResponse<List<SpaceUserAnalyzeResponse>> getSpaceUserAnalyze(@RequestBody SpaceUserAnalyzeRequest spaceUserAnalyzeRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(spaceUserAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    List<SpaceUserAnalyzeResponse> resultList = spaceAnalyzeService.getSpaceUserAnalyze(spaceUserAnalyzeRequest, loginUser);
    return ResultUtils.success(resultList);
}
```

ä¸Šè¿°çš„è¿™äº›éœ€æ±‚ï¼Œå¯ä»¥åŒæ—¶ç»™ç”¨æˆ·å’Œç®¡ç†å‘˜ä½¿ç”¨ï¼Œå·²ç»æ»¡è¶³äº†ç®¡ç†å‘˜ â€œå…¨ç©ºé—´èµ„æºä½¿ç”¨åˆ†æâ€ çš„éœ€æ±‚ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦å•ç‹¬å¼€å‘ä¸€ä¸ª **ä»…ç®¡ç†å‘˜å¯ä½¿ç”¨çš„åŠŸèƒ½** â€”â€” ç©ºé—´ä½¿ç”¨æ’è¡Œåˆ†æã€‚

#### 6ã€ç©ºé—´ä½¿ç”¨æ’è¡Œåˆ†æ

è¯¥åŠŸèƒ½ä»…ç®¡ç†å‘˜å¯ä½¿ç”¨ï¼Œè¿”å›å€¼å°±æ˜¯å‰ N ä¸ªç©ºé—´çš„ä¿¡æ¯ã€‚ç”±äºå·²ç»æœ‰ç°æˆçš„ Space ç©ºé—´å¯¹è±¡ï¼Œå°±ä¸ç”¨ç¼–å†™å“åº”è§†å›¾ç±»äº†ã€‚

1ï¼‰å¼€å‘è¯·æ±‚å°è£…ç±»ã€‚ç©ºé—´ä½¿ç”¨æ’è¡Œéœ€è¦æ¥æ”¶ä¸€ä¸ªå‚æ•° `topN`ï¼ŒæŒ‡å®šè¦è¿”å›çš„å‰ N åç©ºé—´ä¿¡æ¯ï¼Œé»˜è®¤å€¼ä¸º 10ï¼š

```java
@Data
public class SpaceRankAnalyzeRequest implements Serializable {

    /**
     * æ’åå‰ N çš„ç©ºé—´
     */
    private Integer topN = 10;

    private static final long serialVersionUID = 1L;
}
```

2ï¼‰å¼€å‘ Service æœåŠ¡ï¼ŒæŒ‰å­˜å‚¨ä½¿ç”¨é‡æ’åºæŸ¥è¯¢å‰ N ä¸ªç©ºé—´ã€‚æ³¨æ„ï¼Œåªæœ‰ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹ç©ºé—´æ’è¡Œï¼š

```java
@Override
public List<Space> getSpaceRankAnalyze(SpaceRankAnalyzeRequest spaceRankAnalyzeRequest, User loginUser) {
ThrowUtils.throwIf(spaceRankAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);

// ä»…ç®¡ç†å‘˜å¯æŸ¥çœ‹ç©ºé—´æ’è¡Œ
ThrowUtils.throwIf(!userService.isAdmin(loginUser), ErrorCode.NO_AUTH_ERROR, "æ— æƒæŸ¥çœ‹ç©ºé—´æ’è¡Œ");

// æ„é€ æŸ¥è¯¢æ¡ä»¶
QueryWrapper<Space> queryWrapper = new QueryWrapper<>();
queryWrapper.select("id", "spaceName", "userId", "totalSize")
        .orderByDesc("totalSize")
        .last("LIMIT " + spaceRankAnalyzeRequest.getTopN()); // å–å‰ N å

// æŸ¥è¯¢ç»“æœ
return spaceService.list(queryWrapper);
}
```

3ï¼‰å¼€å‘æ¥å£ï¼š

```java
@PostMapping("/rank")
public BaseResponse<List<Space>> getSpaceRankAnalyze(@RequestBody SpaceRankAnalyzeRequest spaceRankAnalyzeRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(spaceRankAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    List<Space> resultList = spaceAnalyzeService.getSpaceRankAnalyze(spaceRankAnalyzeRequest, loginUser);
    return ResultUtils.success(resultList);
}
```

è‡³æ­¤ï¼Œåˆ†æéœ€æ±‚çš„åç«¯æ¥å£å°±å¼€å‘å®Œæˆäº†

### 3ã€æ‰©å±•çŸ¥è¯† - è‡ªå®šä¹‰ SQL

ä¸Šè¿°çš„éœ€æ±‚æˆ‘ä»¬æ˜¯é€šè¿‡ MyBatis Plus æä¾›çš„æ–¹æ³•å®ç°æ•°æ®åº“çš„åˆ†ç»„æ’åºæŸ¥è¯¢ï¼Œå¯¹äºæ›´å¤æ‚å¤šæ ·çš„åˆ†æéœ€æ±‚ï¼Œå…¶å®æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå·±åœ¨ä»£ç ä¸­ç¼–å†™ SQL è¯­å¥ã€‚

å¯èƒ½æœ‰éƒ¨åˆ†åŒå­¦ä¼šå¥½å¥‡ï¼ŒMyBatis è¿˜èƒ½è‡ªå®šä¹‰ SQLï¼Ÿä¸éƒ½æ˜¯ç›´æ¥è°ƒç”¨ `xxx.select` ä¹‹ç±»çš„æ–¹æ³•ä¹ˆï¼Ÿ

è¿™å°±æ˜¯å…¸å‹çš„â€œç”¨æ¡†æ¶ä¹ æƒ¯äº†â€ï¼Œå…¶å®ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ã€é¿å…è‡ªå·±å†™ SQLï¼Œæˆ‘ä»¬ä¹‹å‰ä¸€ç›´ä½¿ç”¨çš„æ˜¯ MyBatis Plus æ¡†æ¶ã€‚ä½†åˆ«å¿˜äº†ï¼ŒMyBatis Plus æ˜¯ MyBatis çš„å¢å¼ºç‰ˆï¼Œæœ¬è´¨è¿˜æ˜¯åŸºäº MyBatis çš„ä¸€äº›èƒ½åŠ›è¿›è¡Œçš„ä¸€äº›å°è£…ç®€åŒ–ï¼Œè‡ªå®šä¹‰ SQL å¯æ˜¯ MyBatis æœ€æœ€æœ€åŸºç¡€çš„èƒ½åŠ›ä¹‹ä¸€ã€‚

åœ¨ MyBatis ä¸€èˆ¬ä¼šä»¥ä¸¤ç§æ–¹å¼æ¥å®ç°è‡ªå®šä¹‰ SQL ï¼š

#### 1ã€Java æ³¨è§£å®ç°

åŸºäº Java æ³¨è§£å†™åœ¨ xxxMapper.java ä¸­ã€‚

æ³¨è§£ä½¿ç”¨å¾ˆç®€å•ï¼Œ åœ¨ mapper å±‚çš„æ¥å£ç±»æ–¹æ³•åˆ©ç”¨ `@Selectã€@Updateã€@Insertã€@Delete` ç­‰æ³¨è§£ï¼Œåœ¨æ³¨è§£å†…å¡«å†™è‡ªå®šä¹‰ SQL è¯­å¥ï¼Œå³å¯å®ç°æŸ¥è¯¢ã€æ›´æ–°ã€å­˜å‚¨ã€åˆ é™¤ã€‚

ä¾‹å¦‚ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•ï¼š

```java
public interface SpaceMapper extends BaseMapper<Space> {

    /**
     * è·å–å­˜å‚¨ä½¿ç”¨é‡æ’åå‰ N çš„ç©ºé—´
     * @param topN æ’åå‰ N
     * @return List<Space>
     */
    @Select("SELECT id, spaceName, userId, totalSize " +
            "FROM space " +
            "ORDER BY totalSize DESC " +
            "LIMIT #{topN}")
    List<Space> getTopNSpaceUsage(int topN);

    /**
     * åˆ é™¤æŸç”¨æˆ·çš„æ‰€æœ‰ç©ºé—´
     *
     * @param userId ç”¨æˆ· ID
     * @return åˆ é™¤çš„è®°å½•æ•°
     */
    @Delete("DELETE FROM space WHERE userId = #{userId}")
    int deleteByUserId(Long userId);
}
```

å®Œæ•´è¯­å¥ = SQL è¯­å¥æ¨¡æ¿ + è®¾ç½®åŠ¨æ€å‚æ•°ã€‚æ–¹æ³•çš„å‚æ•°å¯ä»¥ä½œä¸ºåŠ¨æ€å‚æ•°è‡ªåŠ¨å¡«å……åˆ° SQL æ¨¡æ¿ä¸­ï¼Œå¾—åˆ°æœ€ç»ˆçš„ SQL è¯­å¥ï¼Œç»“æœä¹Ÿä¼šè‡ªåŠ¨è½¬æˆæ–¹æ³•è¿”å›å€¼çš„ Java ç±»å‹ã€‚

ğŸ’¡ é€šè¿‡ #{} å’Œ ${} éƒ½å¯ä»¥å®ç° SQL å‚æ•°ç»‘å®šï¼Œä½†æ˜¯ä¸¤è€…æ˜¯æœ‰åŒºåˆ«çš„ã€‚#{} æ˜¯é¢„ç¼–è¯‘å‚æ•°ï¼Œå¯ä»¥é˜²æ­¢ SQL æ³¨å…¥ï¼Œè€Œ ${} æ˜¯ç›´æ¥æ›¿æ¢ï¼Œä¼šå¯¼è‡´ SQL æ³¨å…¥ã€‚

#### 2ã€XML é…ç½®å®ç°

åŸºäº XML é…ç½®æ–‡ä»¶å†™åœ¨ xxxMapper.xml ä¸­ã€‚

ä¹‹å‰é€šè¿‡ä»£ç ç”Ÿæˆå™¨ï¼Œé¡¹ç›®é‡Œé¢å·²ç»æœ‰å¾ˆå¤š xxxMapper.xml é…ç½®æ–‡ä»¶äº†ã€‚æ¯”å¦‚ SpaceMapper.xmlï¼Œé‡Œé¢å®šä¹‰äº†è¡¨å’Œ Java ç±»çš„å­—æ®µæ˜ å°„ã€SQL å­—æ®µåˆ—è¡¨ç‰‡æ®µã€‚

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yupi.yupicturebackend.mapper.SpaceMapper">

    <resultMap id="BaseResultMap" type="com.yupi.yupicturebackend.model.entity.Space">
        <id property="id" column="id" jdbcType="BIGINT"/>
        <result property="spaceName" column="spaceName" jdbcType="VARCHAR"/>
        <result property="spaceLevel" column="spaceLevel" jdbcType="INTEGER"/>
        <result property="maxSize" column="maxSize" jdbcType="BIGINT"/>
        <result property="maxCount" column="maxCount" jdbcType="BIGINT"/>
        <result property="totalSize" column="totalSize" jdbcType="BIGINT"/>
        <result property="totalCount" column="totalCount" jdbcType="BIGINT"/>
        <result property="userId" column="userId" jdbcType="BIGINT"/>
        <result property="createTime" column="createTime" jdbcType="TIMESTAMP"/>
        <result property="editTime" column="editTime" jdbcType="TIMESTAMP"/>
        <result property="updateTime" column="updateTime" jdbcType="TIMESTAMP"/>
        <result property="isDelete" column="isDelete" jdbcType="TINYINT"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,spaceName,spaceLevel,
        maxSize,maxCount,totalSize,
        totalCount,userId,createTime,
        editTime,updateTime,isDelete
    </sql>
</mapper>
```

ä¸ç”¨è‡ªå·±æ–°å»ºï¼Œä»…éœ€åœ¨é‡Œé¢æ·»åŠ è‡ªå®šä¹‰çš„ SQL ä»£ç å³å¯ã€‚

è·Ÿæ³¨è§£ç±»ä¼¼ï¼ŒMyBatis XML ä¸­æä¾›äº† `<select>`ã€`<update>`ã€`<insert>`ã€`<delete>` ç­‰è¯­æ³•ï¼Œåœ¨å†…éƒ¨æ·»åŠ è‡ªå®šä¹‰ SQL ï¼Œå³å¯å®ç°æŸ¥è¯¢ã€æ›´æ–°ã€å­˜å‚¨ã€åˆ é™¤ã€‚

ç§»é™¤ä¸Šè¿° Mapper çš„ SQL æ³¨è§£ï¼Œç„¶ååœ¨ XML æ–‡ä»¶ä¸­ç¼–å†™ SQL ç‰‡æ®µï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```xml
<!-- è·å–å­˜å‚¨ä½¿ç”¨é‡æ’åå‰ N çš„ç©ºé—´ -->
<select id="getTopNSpaceUsage" resultType="com.yupi.Space">
  SELECT id, spaceName, userId, totalSize
  FROM space
  ORDER BY totalSize DESC
  LIMIT #{topN}
</select>

<!-- åˆ é™¤æŸç”¨æˆ·çš„æ‰€æœ‰ç©ºé—´ -->
<delete id="deleteByUserId">
  DELETE FROM space WHERE userId = #{userId}
</delete>
```

éœ€è¦æ³¨æ„ 2 ç‚¹ï¼š

1. Mapper æ¥å£ä¸­çš„æ–¹æ³•åç§°å¿…é¡»ä¸ XML æ–‡ä»¶ä¸­å®šä¹‰çš„ SQL ç‰‡æ®µçš„ id å¯¹åº”ï¼ŒMyBatis æ‰èƒ½æ­£ç¡®è§£æå’ŒåŒ¹é…æ–¹æ³•ã€‚
2. Mapper æ¥å£æ–¹æ³•çš„è¿”å›ç±»å‹éœ€è¦ä¸ XML æ–‡ä»¶ä¸­ resultTypeï¼ˆæˆ– resultMapï¼‰çš„å®šä¹‰ä¿æŒä¸€è‡´ï¼Œä»¥ç¡®ä¿æŸ¥è¯¢ç»“æœèƒ½å¤Ÿæ­£ç¡®æ˜ å°„åˆ°è¿”å›å¯¹è±¡ã€‚

è¿™æ ·ä¸€æ¥ï¼ŒMyBatis åœ¨è¿è¡Œæ—¶ä¼šæ ¹æ® Mapper æ¥å£è§£æå¯¹åº”çš„ XML æ–‡ä»¶ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå°†æ¥å£æ–¹æ³•ä¸ SQL æ‰§è¡Œé€»è¾‘å…³è”èµ·æ¥ã€‚

### 4ã€æ‰©å±•çŸ¥è¯† - æŸ¥è¯¢åŠ é€Ÿ

æ•°æ®åˆ†æé€šå¸¸æœ‰ 2 ç§å¤„ç†æ–¹å¼ï¼Œå®æ—¶åˆ†æå’Œç¦»çº¿åˆ†æã€‚

å®æ—¶åˆ†ææ˜¯æŒ‡åœ¨æ•°æ®ç”Ÿæˆçš„åŒæ—¶ï¼Œç«‹å³å¯¹å…¶è¿›è¡Œå¤„ç†å’Œåˆ†æï¼Œä»¥æä¾›å³æ—¶çš„ç»“æœï¼Œè¿™ç§æ–¹å¼é€‚ç”¨äºéœ€è¦å¿«é€Ÿå†³ç­–çš„åœºæ™¯ï¼Œæ¯”å¦‚ç›‘æ§ç³»ç»Ÿä¸­çš„å¼‚å¸¸æ£€æµ‹æˆ–ç”µå•†çš„å®æ—¶æ¨èï¼›ç¦»çº¿æ•°æ®åˆ†æåˆ™æ˜¯åœ¨æ‰¹é‡æ”¶é›†å’Œå­˜å‚¨æ•°æ®åï¼Œè¿›è¡Œå¤æ‚è®¡ç®—å’Œæ·±åº¦åˆ†æï¼Œé€‚åˆæ•°æ®é‡æå¤§ã€ä¸éœ€è¦å³æ—¶ç»“æœçš„åœºæ™¯ï¼Œæ¯”å¦‚ç”Ÿæˆå†å²æŠ¥è¡¨æˆ–æŒ–æ˜æ•°æ®ä¸­çš„æ½œåœ¨ç‰¹å¾ã€‚

å³ä½¿æˆ‘ä»¬æ²¡å­¦è¿‡å¤§æ•°æ®æŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸šåŠ¡é€»è¾‘å±‚çš„ç¼–ç åŠ é€Ÿæ•°æ®æŸ¥è¯¢å’Œåˆ†æï¼Œå…¸å‹çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ç¼“å­˜ã€‚åˆ©ç”¨ Redis åˆ†å¸ƒå¼ç¼“å­˜æˆ–æœ¬åœ°ç¼“å­˜æ¥å­˜å‚¨å¾€æœŸçš„æŸ¥è¯¢ç»“æœï¼Œå¹¶è®¾å®šä¸€å®šçš„è¿‡æœŸæ—¶é—´ï¼Œå°±èƒ½é¿å…é‡å¤è®¡ç®—å¹¶å¿«é€Ÿå“åº”ã€‚

å½“ç„¶ï¼Œå¯¹äºå®šæœŸçš„åˆ†æè¯‰æ±‚ï¼ˆæ¯”å¦‚è®¡ç®—æ¯æ—¥çš„æ’è¡Œæ¦œï¼‰è¿˜æœ‰ä¸€ç§å…¸å‹çš„æ–¹æ¡ˆï¼Œæ˜¯é€šè¿‡==å®šæ—¶ä»»åŠ¡==è®¡ç®—æ¯æ—¥çš„ç»“æœå¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä¹‹åå°±å¯ä»¥æŒ‰ç…§æ—¥æœŸæ¥ç›´æ¥æŸ¥è¯¢æŸå¤©çš„ç»“æœäº†ã€‚

æ¯”å¦‚ä¸Šè¿°éœ€æ±‚ä¸­çš„ â€œç”¨æˆ·ä¸Šä¼ è¡Œä¸ºåˆ†æâ€ï¼Œå°±å¯ä»¥æ¯æ—¥è®¡ç®—æŸä¸ªç©ºé—´çš„ç”¨æˆ·ä¸Šä¼ æƒ…å†µï¼ŒæŸ¥è¯¢æ—¶ç›´æ¥èŒƒå›´æŸ¥è¯¢æ—¥æœŸã€‚

| æ’å | ç»Ÿè®¡æ—¥æœŸ   | ç©ºé—´ ID | ç©ºé—´åç§°       | ç”¨æˆ· ID | æ€»å¤§å° (MB) |
| ---- | ---------- | ------- | -------------- | ------- | ----------- |
| 1    | 2024-12-13 | 1001    | é±¼çš®çš„ä¸ªäººç©ºé—´ | 2001    | 2048        |
| 2    | 2024-12-13 | 1002    | å¼ ä¸‰çš„ä¸ªäººç©ºé—´ | 2002    | 1832        |
| 3    | 2024-12-13 | 1003    | æå››çš„ä¸ªäººç©ºé—´ | 2003    | 1456        |
| 4    | 2024-12-13 | 1004    | å­™äº”çš„ä¸ªäººç©ºé—´ | 2004    | 1387        |
| 5    | 2024-12-13 | 1005    | è€å…­çš„ä¸ªäººç©ºé—´ | 2005    | 1203        |