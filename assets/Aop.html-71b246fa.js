import{_ as n,W as s,X as a,a1 as e}from"./framework-4e10303a.js";const t={},p=e(`<h2 id="ğŸ‚-æ™ºèƒ½ååŒäº‘å›¾åº“" tabindex="-1"><a class="header-anchor" href="#ğŸ‚-æ™ºèƒ½ååŒäº‘å›¾åº“" aria-hidden="true">#</a> ğŸ‚ æ™ºèƒ½ååŒäº‘å›¾åº“</h2><h4 id="enableaspectjautoproxy-exposepro-xy-true-æœ‰ä»€ä¹ˆç”¨" tabindex="-1"><a class="header-anchor" href="#enableaspectjautoproxy-exposepro-xy-true-æœ‰ä»€ä¹ˆç”¨" aria-hidden="true">#</a> @EnableAspectJAutoProxy(exposePro xy = true)æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h4><p>å®ƒæ˜¯å¯ç”¨åŸºäºAspectJçš„ AOP åŠŸèƒ½çš„æ„æ€,å®ƒä¼šå‘Šè¯‰ Spring ä½¿ç”¨ä»£ç†æ¥å¤„ç†å¸¦æœ‰ AOP æ³¨è§£çš„ç±»ã€‚</p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring åˆ›å»ºçš„ä»£ç†å¯¹è±¡æ˜¯ä¸å¯ç›´æ¥è®¿é—®çš„ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ Spring å®¹å™¨ä¸­ç®¡ç†çš„å¯¹è±¡ã€‚</li><li>é€šè¿‡è®¾ç½® exposeProxy = trueï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­è®¿é—®åˆ°ä»£ç†å¯¹è±¡ï¼Œ</li><li>ä»è€Œä½¿å¾—ä½ èƒ½å¤Ÿåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹è·å–å’Œæ“ä½œä»£ç†å¯¹è±¡ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸šåŠ¡ç±» <strong><code>UserService</code></strong>ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ol><li><code>createUser()</code>ï¼šåˆ›å»ºç”¨æˆ·ï¼ŒåŒæ—¶è°ƒç”¨ <code>sendNotification()</code> æ–¹æ³•ã€‚</li><li><code>sendNotification()</code>ï¼šå‘é€é€šçŸ¥ã€‚</li></ol><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåˆ‡é¢ï¼ˆ<code>LoggingAspect</code>ï¼‰ç”¨æ¥è®°å½•æ–¹æ³•è°ƒç”¨æ—¥å¿—ã€‚</p><p><strong>é‡ç‚¹é—®é¢˜</strong>ï¼š å¦‚æœæˆ‘ä»¬åœ¨ <code>createUser()</code> æ–¹æ³•å†…éƒ¨ç›´æ¥è°ƒç”¨ <code>sendNotification()</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹ Spring AOP ä¸ä¼šæ‹¦æˆªè¿™ä¸ªè°ƒç”¨ï¼ˆå› ä¸ºå†…éƒ¨æ–¹æ³•è°ƒç”¨ä¸ä¼šç»è¿‡ä»£ç†å¯¹è±¡ï¼‰ã€‚ é€šè¿‡ <code>exposeProxy = true</code> å’Œ <code>AopContext.currentProxy()</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…éƒ¨æ–¹æ³•è°ƒç”¨ä¸­è·å–ä»£ç†å¯¹è±¡ï¼Œä»è€Œè®©åˆ‡é¢æ­£å¸¸å·¥ä½œã€‚</p><h3 id="_1-é¡¹ç›®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-é¡¹ç›®ç»“æ„" aria-hidden="true">#</a> 1. <strong>é¡¹ç›®ç»“æ„</strong></h3><div class="language-less line-numbers-mode" data-ext="less"><pre class="language-less"><code>src<span class="token operator">/</span>main<span class="token operator">/</span>java
  â”œâ”€â”€ AppConfig.java              <span class="token comment">// Spring é…ç½®ç±»</span>
  â”œâ”€â”€ UserService.java            <span class="token comment">// ä¸šåŠ¡ç±»</span>
  â”œâ”€â”€ LoggingAspect.java          <span class="token comment">// åˆ‡é¢ç±»</span>
  â””â”€â”€ MainApp.java                <span class="token comment">// å¯åŠ¨ç±»</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ä»£ç å®ç°" tabindex="-1"><a class="header-anchor" href="#_2-ä»£ç å®ç°" aria-hidden="true">#</a> 2. <strong>ä»£ç å®ç°</strong></h3><h4 id="_2-1-spring-é…ç½®ç±»-å¯ç”¨-aop-å¹¶æš´éœ²ä»£ç†å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_2-1-spring-é…ç½®ç±»-å¯ç”¨-aop-å¹¶æš´éœ²ä»£ç†å¯¹è±¡" aria-hidden="true">#</a> 2.1 <strong>Spring é…ç½®ç±»ï¼ˆå¯ç”¨ AOP å¹¶æš´éœ²ä»£ç†å¯¹è±¡ï¼‰</strong></h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableAspectJAutoProxy</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.example&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// æ‰«æå½“å‰åŒ…ä¸‹çš„ç»„ä»¶</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span><span class="token punctuation">(</span>exposeProxy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>  <span class="token comment">// å¯ç”¨ AOPï¼Œå¹¶æš´éœ²ä»£ç†å¯¹è±¡</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-ä¸šåŠ¡ç±»-userservice" tabindex="-1"><a class="header-anchor" href="#_2-2-ä¸šåŠ¡ç±»-userservice" aria-hidden="true">#</a> 2.2 <strong>ä¸šåŠ¡ç±»ï¼ˆUserServiceï¼‰</strong></h4><p>åœ¨ <code>createUser()</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>AopContext.currentProxy()</code> è·å–ä»£ç†å¯¹è±¡å¹¶è°ƒç”¨ <code>sendNotification()</code>ï¼Œä»è€Œè§¦å‘åˆ‡é¢å¢å¼ºã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span><span class="token class-name">AopContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ­£åœ¨åˆ›å»ºç”¨æˆ·...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç›´æ¥è°ƒç”¨å½“å‰ç±»çš„å¦ä¸€ä¸ªæ–¹æ³•</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç›´æ¥è°ƒç”¨ sendNotification() æ–¹æ³•ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sendNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç›´æ¥è°ƒç”¨ï¼Œä¸ä¼šè§¦å‘åˆ‡é¢</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\\né€šè¿‡ä»£ç†è°ƒç”¨ sendNotification() æ–¹æ³•ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–å½“å‰ä»£ç†å¯¹è±¡å¹¶è°ƒç”¨æ–¹æ³•</span>
        <span class="token class-name">UserService</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> <span class="token class-name">AopContext</span><span class="token punctuation">.</span><span class="token function">currentProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">sendNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// é€šè¿‡ä»£ç†è°ƒç”¨ï¼Œä¼šè§¦å‘åˆ‡é¢</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ­£åœ¨å‘é€é€šçŸ¥...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-åˆ‡é¢ç±»-loggingaspect" tabindex="-1"><a class="header-anchor" href="#_2-3-åˆ‡é¢ç±»-loggingaspect" aria-hidden="true">#</a> 2.3 <strong>åˆ‡é¢ç±»ï¼ˆLoggingAspectï¼‰</strong></h4><p>åˆ‡é¢ä¼šåœ¨ <code>UserService</code> çš„æ–¹æ³•æ‰§è¡Œå‰åè®°å½•æ—¥å¿—ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Before</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">After</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoggingAspect</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* com.qtp.picture.UserService.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logBefore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[æ—¥å¿—] æ–¹æ³•æ‰§è¡Œå¼€å§‹ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;execution(* com.qtp.picture.UserService.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logAfter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[æ—¥å¿—] æ–¹æ³•æ‰§è¡Œç»“æŸã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-å¯åŠ¨ç±»-mainapp" tabindex="-1"><a class="header-anchor" href="#_2-4-å¯åŠ¨ç±»-mainapp" aria-hidden="true">#</a> 2.4 <strong>å¯åŠ¨ç±»ï¼ˆMainAppï¼‰</strong></h4><p>å¯åŠ¨ Spring å®¹å™¨ï¼Œè·å– <code>UserService</code> å¹¶è°ƒç”¨æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AnnotationConfigApplicationContext</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApp</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åŠ è½½ Spring å®¹å™¨</span>
        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å– UserService Bean</span>
        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è°ƒç”¨ createUser() æ–¹æ³•</span>
        userService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-æ‰§è¡Œè¾“å‡º" tabindex="-1"><a class="header-anchor" href="#_3-æ‰§è¡Œè¾“å‡º" aria-hidden="true">#</a> 3. <strong>æ‰§è¡Œè¾“å‡º</strong></h3><p>è¿è¡Œ <code>MainApp</code>ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><div class="language-scss line-numbers-mode" data-ext="scss"><pre class="language-scss"><code>æ­£åœ¨åˆ›å»ºç”¨æˆ·...
ç›´æ¥è°ƒç”¨ <span class="token function">sendNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ–¹æ³•ï¼š
æ­£åœ¨å‘é€é€šçŸ¥...

é€šè¿‡ä»£ç†è°ƒç”¨ <span class="token function">sendNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ–¹æ³•ï¼š
[æ—¥å¿—] æ–¹æ³•æ‰§è¡Œå¼€å§‹ã€‚
æ­£åœ¨å‘é€é€šçŸ¥...
[æ—¥å¿—] æ–¹æ³•æ‰§è¡Œç»“æŸã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_4-æ€»ç»“" aria-hidden="true">#</a> 4. <strong>æ€»ç»“</strong></h3><ul><li><strong>å®é™…ç”¨é€”</strong>ï¼šåœ¨ä¸šåŠ¡é€»è¾‘å¤æ‚ã€éœ€è¦è§¦å‘åˆ‡é¢å¢å¼ºçš„å†…éƒ¨æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚é€šè¿‡ <code>exposeProxy = true</code> æš´éœ²ä»£ç†å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ <code>AopContext.currentProxy()</code> è·å–å½“å‰ä»£ç†å¯¹è±¡ï¼Œè¿™æ ·è°ƒç”¨æ–¹æ³•æ—¶å°±èƒ½è§¦å‘åˆ‡é¢é€»è¾‘ã€‚</li></ul>`,28),o=[p];function c(i,l){return s(),a("div",null,o)}const r=n(t,[["render",c],["__file","Aop.html.vue"]]);export{r as default};
