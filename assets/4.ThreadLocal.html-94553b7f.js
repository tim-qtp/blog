import{_ as a,W as n,X as s,a2 as e}from"./framework-6a3aa88c.js";const c={},t=e(`<h3 id="ğŸŒŸthreadlocal-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸŒŸthreadlocal-æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> ğŸŒŸThreadLocal æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ThreadLocal æ˜¯ä¸€ç§ç”¨äºå®ç°çº¿ç¨‹å±€éƒ¨å˜é‡çš„å·¥å…·ç±»ã€‚å®ƒå…è®¸æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹å‰¯æœ¬ï¼Œä»è€Œå®ç°çº¿ç¨‹éš”ç¦»ã€‚</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503112042604.png" alt="ThreadLocalçº¿ç¨‹å‰¯æœ¬" tabindex="0" loading="lazy"><figcaption>ThreadLocalçº¿ç¨‹å‰¯æœ¬</figcaption></figure><p>ä½¿ç”¨ ThreadLocal é€šå¸¸åˆ†ä¸ºå››æ­¥ï¼š</p><p>â‘ ã€åˆ›å»º ThreadLocal</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//åˆ›å»ºä¸€ä¸ªThreadLocalå˜é‡</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> localVariable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¡ã€è®¾ç½® ThreadLocal çš„å€¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//è®¾ç½®ThreadLocalå˜é‡çš„å€¼</span>
localVariable<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;æ²‰é»˜ç‹äºŒæ˜¯æ²™é›•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘¢ã€è·å– ThreadLocal çš„å€¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//è·å–ThreadLocalå˜é‡çš„å€¼</span>
<span class="token class-name">String</span> value <span class="token operator">=</span> localVariable<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘£ã€åˆ é™¤ ThreadLocal çš„å€¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//åˆ é™¤ThreadLocalå˜é‡çš„å€¼</span>
localVariable<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Web åº”ç”¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ ThreadLocal å­˜å‚¨ç”¨æˆ·ä¼šè¯ä¿¡æ¯ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹åœ¨å¤„ç†ç”¨æˆ·è¯·æ±‚æ—¶éƒ½èƒ½æ–¹ä¾¿åœ°è®¿é—®å½“å‰ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚</p><p>åœ¨æ•°æ®åº“æ“ä½œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ ThreadLocal å­˜å‚¨æ•°æ®åº“è¿æ¥å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®åº“è¿æ¥ï¼Œä»è€Œé¿å…äº†å¤šçº¿ç¨‹ç«äº‰åŒä¸€æ•°æ®åº“è¿æ¥çš„é—®é¢˜ã€‚</p><p>åœ¨æ ¼å¼åŒ–æ“ä½œä¸­ï¼Œä¾‹å¦‚æ—¥æœŸæ ¼å¼åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ ThreadLocal å­˜å‚¨ SimpleDateFormat å®ä¾‹ï¼Œé¿å…å¤šçº¿ç¨‹å…±äº«åŒä¸€å®ä¾‹å¯¼è‡´çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><h3 id="threadlocal-æœ‰å“ªäº›ä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#threadlocal-æœ‰å“ªäº›ä¼˜ç‚¹" aria-hidden="true">#</a> ThreadLocal æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ</h3><p>æ¯ä¸ªçº¿ç¨‹è®¿é—®çš„å˜é‡å‰¯æœ¬éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œé¿å…äº†å…±äº«å˜é‡å¼•èµ·çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ç”±äº ThreadLocal å®ç°äº†å˜é‡çš„çº¿ç¨‹ç‹¬å ï¼Œä½¿å¾—å˜é‡ä¸éœ€è¦åŒæ­¥å¤„ç†ï¼Œå› æ­¤èƒ½å¤Ÿé¿å…èµ„æºç«äº‰ã€‚</p><p>ThreadLocal å¯ç”¨äºè·¨æ–¹æ³•ã€è·¨ç±»æ—¶ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®ï¼Œä¸éœ€è¦åœ¨æ–¹æ³•é—´ä¼ é€’å‚æ•°ã€‚</p><h3 id="å®é™…é¡¹ç›®ä¸­ç”¨åˆ°çš„-threadlocal" tabindex="-1"><a class="header-anchor" href="#å®é™…é¡¹ç›®ä¸­ç”¨åˆ°çš„-threadlocal" aria-hidden="true">#</a> å®é™…é¡¹ç›®ä¸­ç”¨åˆ°çš„ ThreadLocal ï¼Ÿ</h3><p>ç”¨æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œç™»å½•åçš„ç”¨æˆ·æ¯æ¬¡è®¿é—®æ¥å£ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ä¸€ä¸ª tokenï¼Œåœ¨æ§åˆ¶å±‚å¯ä»¥æ ¹æ®è¿™ä¸ª tokenï¼Œè§£æå‡ºç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€‚</p><p>å‡å¦‚åœ¨æœåŠ¡å±‚å’ŒæŒä¹…å±‚ä¹Ÿè¦ç”¨åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°±å¯ä»¥åœ¨æ§åˆ¶å±‚æ‹¦æˆªè¯·æ±‚æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥ ThreadLocalã€‚</p><p>è¿™æ ·æˆ‘ä»¬åœ¨ä»»ä½•ä¸€ä¸ªåœ°æ–¹ï¼Œéƒ½å¯ä»¥å–å‡º ThreadLocal ä¸­å­˜çš„ç”¨æˆ·ä¿¡æ¯</p><p>å¾ˆå¤šå…¶å®ƒåœºæ™¯çš„ cookieã€session ç­‰ç­‰æ•°æ®éš”ç¦»éƒ½å¯ä»¥é€šè¿‡ ThreadLocal å»å®ç°ã€‚</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503112047687.png" alt="ThreadLocaå­˜æ”¾ç”¨æˆ·ä¸Šä¸‹æ–‡" tabindex="0" loading="lazy"><figcaption>ThreadLocaå­˜æ”¾ç”¨æˆ·ä¸Šä¸‹æ–‡</figcaption></figure><h3 id="threadlocal-æ€ä¹ˆå®ç°çš„å‘¢" tabindex="-1"><a class="header-anchor" href="#threadlocal-æ€ä¹ˆå®ç°çš„å‘¢" aria-hidden="true">#</a> ThreadLocal æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</h3><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª ThreadLocal å¯¹è±¡å¹¶è°ƒç”¨ set æ–¹æ³•æ—¶ï¼Œå…¶å®æ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­åˆå§‹åŒ–äº†ä¸€ä¸ª ThreadLocalMapã€‚</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503112047996.png" alt="ThreadLocalMap" tabindex="0" loading="lazy"><figcaption>ThreadLocalMap</figcaption></figure><p>ThreadLocalMap æ˜¯ ThreadLocal çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Entry æ•°ç»„ï¼Œkey æ˜¯ ThreadLocal å¯¹è±¡ï¼Œvalue æ˜¯çº¿ç¨‹çš„å±€éƒ¨å˜é‡ï¼Œè¿™æ ·å°±ç›¸å½“äºä¸ºæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªå˜é‡å‰¯æœ¬ã€‚</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503112048408.png" alt="ThreadLocaç»“æ„å›¾" tabindex="0" loading="lazy"><figcaption>ThreadLocaç»“æ„å›¾</figcaption></figure><p>Entry ç»§æ‰¿äº† WeakReferenceï¼Œå®ƒé™å®šäº† key æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œå¼±å¼•ç”¨çš„å¥½å¤„æ˜¯å½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM ä¼šå›æ”¶ ThreadLocal å¯¹è±¡ï¼Œå¹¶ä¸”å°†å…¶å¯¹åº”çš„ Entry.value è®¾ç½®ä¸º nullï¼Œè¿™æ ·å¯ä»¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å†…å­˜æ³„æ¼ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span> <span class="token keyword">extends</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ThreadLocal</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** The value associated with this ThreadLocal. */</span>
    <span class="token class-name">Object</span> value<span class="token punctuation">;</span>

    <span class="token comment">//èŠ‚ç‚¹ç±»</span>
    <span class="token class-name">Entry</span><span class="token punctuation">(</span><span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> k<span class="token punctuation">,</span> <span class="token class-name">Object</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//keyèµ‹å€¼</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//valueèµ‹å€¼</span>
        value <span class="token operator">=</span> v<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><p>ThreadLocal çš„å®ç°åŸç†æ˜¯ï¼Œæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ª Mapï¼Œkey ä¸º ThreadLocal å¯¹è±¡ï¼Œvalue ä¸ºæƒ³è¦å®ç°çº¿ç¨‹éš”ç¦»çš„å˜é‡ï¼ˆå¯¹è±¡ï¼‰ã€‚</p><p>1ã€é€šè¿‡ ThreadLocal çš„ set æ–¹æ³•å°†å¯¹è±¡å­˜å…¥ Map ä¸­ã€‚</p><p>2ã€é€šè¿‡ ThreadLocal çš„ get æ–¹æ³•ä» Map ä¸­å–å‡ºå¯¹è±¡ã€‚</p><p>3ã€Map çš„å¤§å°ç”± ThreadLocal å¯¹è±¡çš„å¤šå°‘å†³å®šã€‚</p><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/202503112113995.png" style="zoom:50%;"><h3 id="ä»€ä¹ˆæ˜¯å¼±å¼•ç”¨-ä»€ä¹ˆæ˜¯å¼ºå¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å¼±å¼•ç”¨-ä»€ä¹ˆæ˜¯å¼ºå¼•ç”¨" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯å¼±å¼•ç”¨ï¼Œä»€ä¹ˆæ˜¯å¼ºå¼•ç”¨ï¼Ÿ</h3><p>å…ˆè¯´ä¸€ä¸‹å¼ºå¼•ç”¨ï¼Œæ¯”å¦‚ <code>User user = new User(&quot;ç§¦ä¸€&quot;)</code> ä¸­ï¼Œuser å°±æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œ<code>new User(&quot;ç§¦ä¸€&quot;)</code> å°±æ˜¯å¼ºå¼•ç”¨å¯¹è±¡ã€‚</p><p>å½“ user è¢«ç½®ä¸º null æ—¶ï¼ˆ<code>user = null</code>ï¼‰ï¼Œ<code>new User(&quot;ç§¦ä¸€&quot;)</code> å¯¹è±¡å°±ä¼šè¢«åƒåœ¾å›æ”¶ï¼›å¦åˆ™å³ä¾¿æ˜¯å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJVM ä¹Ÿä¸ä¼šå›æ”¶ <code>new User(&quot;ç§¦ä¸€&quot;)</code> è¿™ä¸ªå¼ºå¼•ç”¨å¯¹è±¡ï¼Œå®æ„¿æŠ›å‡º OutOfMemoryErrorã€‚</p><p>å¼±å¼•ç”¨ï¼Œæ¯”å¦‚è¯´åœ¨ä½¿ç”¨ ThreadLocal ä¸­ï¼ŒEntry çš„ key å°±æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨å¯¹è±¡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userThreadLocal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userThreadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;æ²‰é»˜ç‹äºŒ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>userThreadLocal æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œ<code>new ThreadLocal&lt;&gt;()</code> æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨å¯¹è±¡ï¼›</p><p><code>new User(&quot;ç§¦ä¸€&quot;)</code> æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨å¯¹è±¡ã€‚</p><p>è°ƒç”¨ set æ–¹æ³•åï¼Œä¼šå°† <code>key = new ThreadLocal&lt;&gt;()</code> æ”¾å…¥ ThreadLocalMap ä¸­ï¼Œæ­¤æ—¶çš„ key æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨å¯¹è±¡ã€‚å½“ JVM è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¦‚æœå‘ç°äº†å¼±å¼•ç”¨å¯¹è±¡ï¼Œå°±ä¼šå°†å…¶å›æ”¶ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨" aria-hidden="true">#</a> <strong>ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨ï¼Ÿ</strong></h3><p>åœ¨ <code>ThreadLocal</code> ä¸­ä½¿ç”¨å¼±å¼•ç”¨çš„åŸå› æ˜¯ï¼š</p><ul><li><strong>é¿å…å†…å­˜æ³„æ¼</strong>ï¼šå¦‚æœ <code>ThreadLocal</code> å¯¹è±¡æ˜¯å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆçº¿ç¨‹ç»“æŸæ—¶ï¼Œ<code>ThreadLocalMap</code> ä¸­çš„æ¡ç›®å¯èƒ½ä¸ä¼šè¢«æ¸…ç†ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li><li><strong>è‡ªåŠ¨æ¸…ç†</strong>ï¼šä½¿ç”¨å¼±å¼•ç”¨å¯ä»¥è®© JVM åœ¨å›æ”¶ <code>ThreadLocal</code> å¯¹è±¡æ—¶ï¼Œè‡ªåŠ¨æ¸…ç†å¯¹åº”çš„æ¡ç›®ï¼Œå‡å°‘å†…å­˜æ³„æ¼çš„é£é™©ã€‚</li></ul><h3 id="çˆ¶çº¿ç¨‹èƒ½ç”¨-threadlocal-ç»™å­çº¿ç¨‹ä¼ å€¼å—" tabindex="-1"><a class="header-anchor" href="#çˆ¶çº¿ç¨‹èƒ½ç”¨-threadlocal-ç»™å­çº¿ç¨‹ä¼ å€¼å—" aria-hidden="true">#</a> çˆ¶çº¿ç¨‹èƒ½ç”¨ ThreadLocal ç»™å­çº¿ç¨‹ä¼ å€¼å—ï¼Ÿ</h3><p>ä¸èƒ½ã€‚</p><p>å› ä¸º ThreadLocal å˜é‡å­˜å‚¨åœ¨æ¯ä¸ªçº¿ç¨‹çš„ ThreadLocalMap ä¸­ï¼Œè€Œå­çº¿ç¨‹<mark>ä¸ä¼šç»§æ‰¿çˆ¶çº¿ç¨‹çš„ ThreadLocalMap</mark>ã€‚</p><p>å¯ä»¥ä½¿ç”¨ <code>InheritableThreadLocal</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>å­çº¿ç¨‹åœ¨åˆ›å»ºçš„æ—¶å€™ä¼šæ‹·è´çˆ¶çº¿ç¨‹çš„ InheritableThreadLocal å˜é‡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">InheritableThreadLocalExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">InheritableThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> inheritableThreadLocal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InheritableThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        inheritableThreadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;çˆ¶çº¿ç¨‹çš„å€¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å­çº¿ç¨‹è·å–çš„å€¼ï¼š&quot;</span> <span class="token operator">+</span> inheritableThreadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»§æ‰¿äº†çˆ¶çº¿ç¨‹çš„å€¼</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="inheritablethreadlocalçš„åŸç†" tabindex="-1"><a class="header-anchor" href="#inheritablethreadlocalçš„åŸç†" aria-hidden="true">#</a> InheritableThreadLocalçš„åŸç†</h3><p>åœ¨ Thread ç±»çš„å®šä¹‰ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸¤ä¸ª ThreadLocalMapï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token comment">/* æ™®é€š ThreadLocal å˜é‡å­˜å‚¨çš„åœ°æ–¹ */</span>
    <span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> threadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">/* InheritableThreadLocal å˜é‡å­˜å‚¨çš„åœ°æ–¹ */</span>
    <span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> inheritableThreadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ™®é€š ThreadLocal å˜é‡å­˜å‚¨åœ¨ threadLocals ä¸­ï¼Œä¸ä¼šè¢«å­çº¿ç¨‹ç»§æ‰¿ã€‚</p><p>InheritableThreadLocal å˜é‡å­˜å‚¨åœ¨ inheritableThreadLocals ä¸­ï¼Œå½“ <code>new Thread()</code> åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹æ—¶ï¼ŒThread çš„ <code>init()</code> æ–¹æ³•ä¼šæ£€æŸ¥çˆ¶çº¿ç¨‹æ˜¯å¦æœ‰ inheritableThreadLocalsï¼Œå¦‚æœæœ‰ï¼Œå°±ä¼šæ‹·è´ InheritableThreadLocal å˜é‡åˆ°å­çº¿ç¨‹ï¼š</p>`,59),p=[t];function o(l,i){return n(),s("div",null,p)}const r=a(c,[["render",o],["__file","4.ThreadLocal.html.vue"]]);export{r as default};
