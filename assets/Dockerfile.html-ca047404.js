import{_ as l,W as p,X as o,$ as a,a0 as e,Z as i,a2 as n,C as c}from"./framework-6a3aa88c.js";const r={},t=n('<h1 id="_3-dockerfile自定义镜像" tabindex="-1"><a class="header-anchor" href="#_3-dockerfile自定义镜像" aria-hidden="true">#</a> 3.Dockerfile自定义镜像</h1><p>常见的镜像在DockerHub就能找到，但是我们自己写的项目就必须自己构建镜像了。</p><p>而要自定义镜像，就必须先了解镜像的结构才行。</p><h2 id="_3-1-镜像结构" tabindex="-1"><a class="header-anchor" href="#_3-1-镜像结构" aria-hidden="true">#</a> 3.1.镜像结构</h2><p>镜像是将应用程序及其需要的系统函数库、环境、配置、依赖打包而成。</p><blockquote><p>总结一下：底层函数库-&gt;环境配置-&gt;依赖安装-&gt;应用安装-&gt;应用配置</p></blockquote><p>我们以MySQL为例，来看看镜像的组成结构：</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/7c4faf36f287a1602ef2f449a274719c.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>简单来说，镜像就是在系统函数库、运行环境基础上，添加应用程序文件、配置文件、依赖文件等组合，然后编写好启动脚本打包在一起形成的文件。</p><p>我们要构建镜像，其实就是实现上述打包的过程。</p><h2 id="_3-2-dockerfile语法" tabindex="-1"><a class="header-anchor" href="#_3-2-dockerfile语法" aria-hidden="true">#</a> 3.2.Dockerfile语法</h2><p>构建自定义的镜像时，并不需要一个个文件去拷贝，打包。</p><p>我们只需要告诉Docker，我们的镜像的组成，需要哪些BaseImage、需要拷贝什么文件、需要安装什么依赖、启动脚本是什么，将来Docker会帮助我们构建镜像。</p><p>而描述上述信息的文件就是Dockerfile文件。</p><p><strong>Dockerfile</strong>就是一个文本文件，其中包含一个个的<strong>指令(Instruction)</strong>，用指令来说明要执行什么操作来构建镜像。每一个指令都会形成一层Layer。</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/4cd4be11c105a058afd23f701e1fdea3.png" alt="image-20210731180321133" tabindex="0" loading="lazy"><figcaption>image-20210731180321133</figcaption></figure>',16),d={href:"https://docs.docker.com/engine/reference/builder",target:"_blank",rel:"noopener noreferrer"},u=n(`<h2 id="_3-3-构建java项目" tabindex="-1"><a class="header-anchor" href="#_3-3-构建java项目" aria-hidden="true">#</a> 3.3.构建Java项目</h2><h3 id="_3-3-1-基于ubuntu构建java项目" tabindex="-1"><a class="header-anchor" href="#_3-3-1-基于ubuntu构建java项目" aria-hidden="true">#</a> 3.3.1.基于Ubuntu构建Java项目</h3><p>需求：基于Ubuntu镜像构建一个新镜像，运行一个java项目</p><ul><li><p>步骤1：新建一个空文件夹docker-demo</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/ad271ae174571c699d8569f93e59a368.png" alt="image-20210801101207444" tabindex="0" loading="lazy"><figcaption>image-20210801101207444</figcaption></figure></li><li><p>步骤2：拷贝课前资料中的docker-demo.jar文件到docker-demo这个目录</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/5c2a909358e751ce36acf80638728e55.png" alt="image-20210801101314816" tabindex="0" loading="lazy"><figcaption>image-20210801101314816</figcaption></figure></li><li><p>步骤3：拷贝课前资料中的jdk8.tar.gz文件到docker-demo这个目录</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/595dda83adf39b5b367112a46f707bef.png" alt="image-20210801101410200" tabindex="0" loading="lazy"><figcaption>image-20210801101410200</figcaption></figure></li><li><p>步骤4：拷贝课前资料提供的Dockerfile到docker-demo这个目录</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/eac750902967e7d35eb526566a51ee11.png" alt="image-20210801101455590" tabindex="0" loading="lazy"><figcaption>image-20210801101455590</figcaption></figure><p>其中的内容如下：</p><div class="language-docker line-numbers-mode" data-ext="docker"><pre class="language-docker"><code><span class="token comment"># 指定基础镜像</span>
<span class="token instruction"><span class="token keyword">FROM</span> ubuntu:16.04</span>
<span class="token comment"># 配置环境变量，JDK的安装目录</span>
<span class="token instruction"><span class="token keyword">ENV</span> JAVA_DIR=/usr/local</span>

<span class="token comment"># 拷贝jdk和java项目的包</span>
<span class="token instruction"><span class="token keyword">COPY</span> ./jdk8.tar.gz <span class="token variable">$JAVA_DIR</span>/</span>
<span class="token instruction"><span class="token keyword">COPY</span> ./docker-demo.jar /tmp/app.jar</span>

<span class="token comment"># 安装JDK</span>
<span class="token instruction"><span class="token keyword">RUN</span> cd <span class="token variable">$JAVA_DIR</span> <span class="token operator">\\</span>
 &amp;&amp; tar -xf ./jdk8.tar.gz <span class="token operator">\\</span>
 &amp;&amp; mv ./jdk1.8.0_144 ./java8</span>

<span class="token comment"># 配置环境变量</span>
<span class="token instruction"><span class="token keyword">ENV</span> JAVA_HOME=<span class="token variable">$JAVA_DIR</span>/java8</span>
<span class="token instruction"><span class="token keyword">ENV</span> PATH=<span class="token variable">$PATH</span>:<span class="token variable">$JAVA_HOME</span>/bin</span>

<span class="token comment"># 暴露端口</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 8090</span>
<span class="token comment"># 入口，java项目的启动命令</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> java -jar /tmp/app.jar</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>步骤5：进入docker-demo</p><p>将准备好的docker-demo上传到虚拟机任意目录，然后进入docker-demo目录下</p></li><li><p>步骤6：运行命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> build <span class="token parameter variable">-t</span> javaweb:1.0 <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>这个点代表的是<code>dockerfile</code>所在的目录</p><figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/0e04b24834f92a52cea43aef331e5654.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,6),m={href:"http://43.143.146.93:8090/hello/count%EF%BC%8C%E5%85%B6%E4%B8%AD%E7%9A%84ip%E6%94%B9%E6%88%90%E4%BD%A0%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BAip",target:"_blank",rel:"noopener noreferrer"},k=n(`<figure><img src="https://qtp-1324720525.cos.ap-shanghai.myqcloud.com/blog/04ed4238af1e2ea2081d1543c32e3548.png" alt="今天被访问了8次" tabindex="0" loading="lazy"><figcaption>今天被访问了8次</figcaption></figure><h3 id="_3-3-2-基于java8构建java项目" tabindex="-1"><a class="header-anchor" href="#_3-3-2-基于java8构建java项目" aria-hidden="true">#</a> 3.3.2.基于java8构建Java项目</h3><p>虽然我们可以基于Ubuntu基础镜像，添加任意自己需要的安装包，构建镜像，但是却比较麻烦。所以大多数情况下，我们都可以在一些安装了部分软件的基础镜像上做改造。</p><p>例如，构建java项目的镜像，可以在已经准备了JDK的基础镜像基础上构建。</p><p>需求：基于java:8-alpine镜像，将一个Java项目构建为镜像</p><p>实现思路如下：</p><ul><li><p>① 新建一个空的目录，然后在目录中新建一个文件，命名为Dockerfile</p></li><li><p>② 拷贝课前资料提供的docker-demo.jar到这个目录中</p></li><li><p>③ 编写Dockerfile文件：</p><ul><li><p>a ）基于java:8-alpine作为基础镜像</p></li><li><p>b ）将app.jar拷贝到镜像中</p></li><li><p>c ）暴露端口</p></li><li><p>d ）编写入口ENTRYPOINT</p><p>内容如下：</p><div class="language-docker line-numbers-mode" data-ext="docker"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> java:8-alpine</span>
<span class="token instruction"><span class="token keyword">COPY</span> ./app.jar /tmp/app.jar</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 8090</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> java -jar /tmp/app.jar</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>④ 使用docker build命令构建镜像</p></li><li><p>⑤ 使用docker run创建容器并运行</p></li></ul><h2 id="_3-4-小结" tabindex="-1"><a class="header-anchor" href="#_3-4-小结" aria-hidden="true">#</a> 3.4.小结</h2><p>小结：</p><ol><li><p>Dockerfile的本质是一个文件，通过指令描述镜像的构建过程</p></li><li><p><mark>Dockerfile的第一行必须是FROM，从一个基础镜像来构建</mark></p></li><li><p>基础镜像可以是基本操作系统，如Ubuntu。也可以是其他人制作好的镜像，例如：java:8-alpine</p></li></ol><blockquote><p><code>java:8-alpine</code> 是一个基于 Alpine Linux 的轻量级 Docker 镜像，它内置了 OpenJDK 8 环境。</p><p>Alpine Linux 是一个轻量级的 Linux 发行版，体积非常小，通常不到 5 MB。<code>java:8-alpine</code> 镜像继承了 Alpine Linux 的小巧特性，整个镜像的大小通常在 10 MB 左右。</p></blockquote>`,11);function g(v,b){const s=c("ExternalLinkIcon");return p(),o("div",null,[t,a("p",null,[e("更新详细语法说明，请参考官网文档： "),a("a",d,[e("https://docs.docker.com/engine/reference/builder"),i(s)])]),u,a("p",null,[e("最后访问"),a("a",m,[e("http://43.143.146.93:8090/hello/count，其中的ip改成你的虚拟机ip"),i(s)])]),k])}const f=l(r,[["render",g],["__file","Dockerfile.html.vue"]]);export{f as default};
